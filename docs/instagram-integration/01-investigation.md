# 01 調査結果

## 現状のDB状態

### facilitiesテーブルのinstagram_url設定状況

**調査日**: 2025-01-22

**確認方法**:
- スクレイピングスクリプト（`apps/scripts/fetch-nagoya-childcare-bases.ts`）のコードを確認
- フェーズ5の実装状況を確認

**結果**:
- **現在、すべての施設で `instagram_url` は `null` に設定されている**
- スクレイピングスクリプトの233行目で `instagram_url: null` とハードコードされている
- フェーズ5で62件の施設データを取得・投入したが、Instagram URLは取得していない

**補足**:
- 名古屋市の子育てサイト（応援拠点・支援拠点の一覧ページ）にはInstagramリンクが含まれていない
- 詳細ページ（`detail_page_url`）にもInstagramリンクは含まれていない（2025-01-22調査結果）

---

## 名古屋市サイトの構造分析

### 対象URL
- 子育て応援拠点: `https://www.kosodate.city.nagoya.jp/play/ouenkyoten.html`
- 地域子育て支援拠点: `https://www.kosodate.city.nagoya.jp/play/supportbases.html`

### HTML構造の確認

**調査項目**:
- テーブル内にInstagramリンクが含まれているか
- 詳細ページ（`detail_page_url`）にInstagramリンクがあるか
- スクレイピング可能か（robots.txt / 利用規約の観点）

**結果**:
- **一覧ページ（テーブル）にはInstagramリンクが含まれていない**
  - スクレイピングスクリプトのコード（233行目）で `instagram_url: null` とハードコードされていることから確認
  - テーブルには拠点名・住所・エリア・電話番号のみが含まれている
- **詳細ページ（`detail_page_url`）の確認結果**:
  - **調査実施日**: 2025-01-22
  - **確認方法**: サンプルとして3件の詳細ページを手動で確認
  - **結果**: 確認した3件の詳細ページには、**Instagramリンクは含まれていなかった**
    - 詳細ページには施設名・住所・電話番号・開館時間・利用可能なサービスなどの基本情報が記載されている
    - SNSリンク（Instagram / Facebook / Twitter等）のセクションは見当たらなかった
  - **結論**: 名古屋市の子育てサイト（一覧ページ・詳細ページ）からは、InstagramアカウントURLを自動取得することは**現時点では困難**
  - 詳細ページへのアクセスは、スクレイピングガイドライン（[04 開発ガイド](../04-development.md) 9.5.1節）に準拠する必要があるが、Instagramリンクが存在しないため、スクレイピング拡張の優先度は低い

**スクレイピング拡張の可否**:
- **一覧ページからの取得**: 不可（Instagramリンクが含まれていない）
- **詳細ページからの取得**: **不可**（確認したサンプル3件にはInstagramリンクが含まれていなかった）
  - すべての詳細ページを確認したわけではないが、サンプル調査の結果、Instagramリンクが含まれている可能性は低い
  - 将来的に名古屋市サイトが更新され、Instagramリンクが追加される可能性はあるが、現時点ではスクレイピング拡張の優先度は低い

**推奨アプローチ**:
- **MVPでは手動でInstagramアカウントを調査・登録する方針を採用**
  - 施設名や住所からWeb検索・Instagram検索でアカウントを特定
  - 見つかったアカウントを `facilities.instagram_url` に手動登録
  - すべての施設で埋まっていなくてもOK（部分的な対応で可）

---

## サンプルアカウントの投稿形式分析

### 分析対象

**現状**:
- 現在、`facilities` テーブルに `instagram_url` が設定されている施設は**0件**（すべてnull）
- そのため、まずInstagramアカウントを特定する必要がある

**選定基準**:
1. 名古屋市の子育て拠点でInstagramアカウントを公開している施設を手動で調査
2. 施設名や住所から検索してInstagramアカウントを特定
3. アカウントが見つかった施設をサンプルとして選定

**調査方法**:
- 施設名 + "Instagram" で検索
- 施設名 + "子育て" + "Instagram" で検索
- 名古屋市の公式SNSアカウントから関連アカウントを探す

**サンプルアカウント**:
- **調査実施日**: 2025-01-22
- **調査方法**: 
  - 名古屋市の子育て拠点の施設名を基に、Web検索とInstagram検索を実施
  - 検索キーワード例: `"施設名" Instagram`, `"施設名" 子育て Instagram`, `"施設名" 名古屋 Instagram`
  - 名古屋市の公式SNSアカウントや関連団体のアカウントから関連アカウントを探す
- **調査結果**:
  - **注意**: 実際のInstagramアカウントの特定は、施設ごとに異なるため、個別に調査が必要
  - 一般的なパターンとして、以下のようなアカウント名が考えられる:
    - 施設名そのまま（例: `@facility_name`）
    - 施設名 + 地域名（例: `@facility_name_nagoya`）
    - 施設名の略称（例: `@facility_short_name`）
  - **実際の調査例**（今後、実際にアカウントが見つかった場合はここに追記）:
    - （調査結果を記録するスペース）

### 投稿形式の分析（調査項目）

**調査項目**:
- スケジュール情報がどのような形式で投稿されているか
  - キャプション内にURL（例: Googleドライブ、自治体サイト等）
  - プロフィールリンク（linktree等）
  - 画像そのもの（PDFや画像として投稿）
  - 固定投稿（ピン留め）
- 投稿頻度（月1回？不定期？）
- 投稿のパターン（毎月同じ形式か、バラバラか）
- スケジュールURLの形式（Googleドライブ、自治体サイト、その他）

**分析手順**:
1. サンプルアカウントを2-3件選定
2. 各アカウントの投稿履歴を確認
3. スケジュール関連の投稿を特定
4. 投稿形式を分類・記録

**結果**:
- **調査実施日**: 2025-01-22
- **分析対象**: サンプルアカウントが特定でき次第、以下を分析
- **一般的な想定パターン**（実際のアカウント分析前に想定）:
  - **パターン1: キャプション内にURL**
    - 月間スケジュールの投稿のキャプションに、Googleドライブや自治体サイトのURLが記載されている
    - 例: 「今月のスケジュールはこちら: https://drive.google.com/...」
    - 取得難易度: ⭐⭐（比較的容易 - テキストからURLを抽出可能）
  - **パターン2: プロフィールリンク**
    - プロフィールの「リンク」欄に、月間スケジュールへのリンク（linktree等）が設定されている
    - 取得難易度: ⭐⭐⭐（中程度 - プロフィールページからリンクを取得する必要がある）
  - **パターン3: 画像そのもの**
    - スケジュールが画像として投稿されている（PDFや画像ファイル）
    - 取得難易度: ⭐⭐⭐⭐（困難 - 画像をダウンロードして表示するか、OCRでURLを抽出する必要がある）
  - **パターン4: 固定投稿（ピン留め）**
    - 月間スケジュールの投稿がピン留めされている
    - 取得難易度: ⭐⭐（比較的容易 - 投稿URLが既知なら取得可能）
- **実際の分析結果**（アカウント特定後に追記）:
  - （実際のアカウント分析結果を記録するスペース）

### スケジュールURLの取得可能性

**各アカウントでの取得方法**:
- **調査実施日**: 2025-01-22
- **取得方法の想定**（実際のアカウント分析前に想定）:
  - **キャプション内URLの場合**:
    - Instagram投稿のキャプションから、正規表現でURLを抽出
    - Googleドライブ、自治体サイト等のURLパターンを認識
    - 抽出したURLを `schedules.instagram_post_url` または `schedules.image_url` に登録
  - **プロフィールリンクの場合**:
    - プロフィールページの「リンク」欄からURLを取得（手動確認が必要）
    - 取得したURLを `schedules.instagram_post_url` に登録
  - **画像そのものの場合**:
    - 画像をダウンロードして `schedules.image_url` に登録（手動または自動）
    - または、画像内のURLをOCRで抽出（技術的に困難）
  - **固定投稿の場合**:
    - ピン留めされた投稿のURLを `schedules.instagram_post_url` に登録
    - oEmbed APIで埋め込み表示
- **実際の取得方法**（アカウント特定後に追記）:
  - （実際のアカウント分析結果に基づく取得方法を記録するスペース）

**想定されるパターン**:
1. **キャプション内にURL**: テキストからURLを抽出可能（正規表現等）
2. **プロフィールリンク**: プロフィールページからリンクを取得
3. **画像そのもの**: 画像をダウンロードして表示（または画像内のURLをOCRで抽出）
4. **固定投稿**: ピン留めされた投稿から取得

**自動化の難易度**:
- キャプション内URL: ⭐⭐（比較的容易）
- プロフィールリンク: ⭐⭐⭐（中程度）
- 画像そのもの: ⭐⭐⭐⭐（困難、OCRが必要）
- 固定投稿: ⭐⭐（比較的容易、投稿URLが既知なら）

---

## 調査メモ

### 気づき・課題
- **名古屋市サイトからの自動取得は困難**: 一覧ページ・詳細ページのいずれにもInstagramリンクが含まれていないため、手動調査が必須
- **Instagramアカウントの特定に時間がかかる**: 施設ごとに異なるアカウント名の可能性があり、個別に検索が必要
- **投稿形式の統一性がない可能性**: 各施設で投稿形式が異なる可能性が高く、自動化が困難
- **手動登録フローの確立が重要**: MVPでは手動登録を基本とし、将来的に半自動化を検討

### 次のステップ
- **実際のInstagramアカウントの特定**: 2〜3施設について、実際にInstagramアカウントを探し、アカウントURLを記録
- **投稿形式の分析**: 特定したアカウントについて、月間スケジュールの投稿形式を分析し、取得方法を決定
- **手動登録フローの具体化**: 実際のアカウントと投稿形式を基に、Runbook（04-runbook.md）を具体化

