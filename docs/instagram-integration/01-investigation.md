# 01 調査結果

## 現状のDB状態

### facilitiesテーブルのinstagram_url設定状況

**調査日**: 2025-01-22

**確認方法**:
- スクレイピングスクリプト（`apps/scripts/fetch-nagoya-childcare-bases.ts`）のコードを確認
- フェーズ5の実装状況を確認

**結果**:
- **現在、すべての施設で `instagram_url` は `null` に設定されている**
- スクレイピングスクリプトの233行目で `instagram_url: null` とハードコードされている
- フェーズ5で62件の施設データを取得・投入したが、Instagram URLは取得していない

**補足**:
- 名古屋市の子育てサイト（応援拠点・支援拠点の一覧ページ）にはInstagramリンクが含まれていない
- 詳細ページ（`detail_page_url`）にInstagramリンクがある可能性はあるが、未確認

---

## 名古屋市サイトの構造分析

### 対象URL
- 子育て応援拠点: `https://www.kosodate.city.nagoya.jp/play/ouenkyoten.html`
- 地域子育て支援拠点: `https://www.kosodate.city.nagoya.jp/play/supportbases.html`

### HTML構造の確認

**調査項目**:
- テーブル内にInstagramリンクが含まれているか
- 詳細ページ（`detail_page_url`）にInstagramリンクがあるか
- スクレイピング可能か（robots.txt / 利用規約の観点）

**結果**:
- **一覧ページ（テーブル）にはInstagramリンクが含まれていない**
  - スクレイピングスクリプトのコード（233行目）で `instagram_url: null` とハードコードされていることから確認
  - テーブルには拠点名・住所・エリア・電話番号のみが含まれている
- **詳細ページ（`detail_page_url`）の確認が必要**
  - 各施設の詳細ページにアクセスしてInstagramリンクがあるか確認する必要がある
  - 詳細ページへのアクセスは、スクレイピングガイドライン（[04 開発ガイド](../04-development.md) 9.5.1節）に準拠する必要がある

**スクレイピング拡張の可否**:
- **一覧ページからの取得**: 不可（Instagramリンクが含まれていない）
- **詳細ページからの取得**: 要調査
  - 詳細ページにInstagramリンクがある場合、スクレイピングスクリプトを拡張して取得可能
  - ただし、62件すべての詳細ページにアクセスする必要があり、アクセス間隔（最低1秒）を考慮すると時間がかかる
  - スクレイピングガイドラインに準拠する必要がある（User-Agent設定、アクセス間隔等）

**推奨アプローチ**:
- まず、サンプルとして数件の詳細ページを手動で確認し、Instagramリンクの有無を確認する
- リンクがある場合は、スクレイピングスクリプトを拡張して取得することを検討
- リンクがない場合は、手動でInstagramアカウントを調査・登録する方針

---

## サンプルアカウントの投稿形式分析

### 分析対象

**現状**:
- 現在、`facilities` テーブルに `instagram_url` が設定されている施設は**0件**（すべてnull）
- そのため、まずInstagramアカウントを特定する必要がある

**選定基準**:
1. 名古屋市の子育て拠点でInstagramアカウントを公開している施設を手動で調査
2. 施設名や住所から検索してInstagramアカウントを特定
3. アカウントが見つかった施設をサンプルとして選定

**調査方法**:
- 施設名 + "Instagram" で検索
- 施設名 + "子育て" + "Instagram" で検索
- 名古屋市の公式SNSアカウントから関連アカウントを探す

**サンプルアカウント**:
- （調査が必要 - 現時点では特定できていない）

### 投稿形式の分析（調査項目）

**調査項目**:
- スケジュール情報がどのような形式で投稿されているか
  - キャプション内にURL（例: Googleドライブ、自治体サイト等）
  - プロフィールリンク（linktree等）
  - 画像そのもの（PDFや画像として投稿）
  - 固定投稿（ピン留め）
- 投稿頻度（月1回？不定期？）
- 投稿のパターン（毎月同じ形式か、バラバラか）
- スケジュールURLの形式（Googleドライブ、自治体サイト、その他）

**分析手順**:
1. サンプルアカウントを2-3件選定
2. 各アカウントの投稿履歴を確認
3. スケジュール関連の投稿を特定
4. 投稿形式を分類・記録

**結果**:
- （調査が必要 - アカウントを特定してから分析）

### スケジュールURLの取得可能性

**各アカウントでの取得方法**:
- （調査が必要 - アカウントを特定してから分析）

**想定されるパターン**:
1. **キャプション内にURL**: テキストからURLを抽出可能（正規表現等）
2. **プロフィールリンク**: プロフィールページからリンクを取得
3. **画像そのもの**: 画像をダウンロードして表示（または画像内のURLをOCRで抽出）
4. **固定投稿**: ピン留めされた投稿から取得

**自動化の難易度**:
- キャプション内URL: ⭐⭐（比較的容易）
- プロフィールリンク: ⭐⭐⭐（中程度）
- 画像そのもの: ⭐⭐⭐⭐（困難、OCRが必要）
- 固定投稿: ⭐⭐（比較的容易、投稿URLが既知なら）

---

## 調査メモ

### 気づき・課題
- （調査中に気づいた点を記録）

### 次のステップ
- （調査結果に基づいて次に確認すべき項目）

