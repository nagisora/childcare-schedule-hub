# チェックリスト式実装計画書: 2025-12-19

> **セッションとは**: このプロジェクトにおける「セッションの定義」は `docs/dev-sessions/session-definition.md` を参照。
>
> **重要（AI作業時）**: このセッションファイルは `date` コマンドで現在日付（`20251219`）を取得したうえで作成している。

## セッション概要とゴール

### 概要

- 一言サマリ: フェーズ10着手前の定義/Runbook整合に加え、フェーズ11〜13も「観測可能な完了条件」に寄せてリリースまでの迷いを減らす
- 対応フェーズ: フェーズ10（準備）/ フェーズ11〜13（準備）
- セッション種別: ドキュメント整備 + 実装準備（必要なら軽微な実装/テスト）
- 実行方式: AI自律
- 影響範囲: `docs/05-00-development-phases.md` / `docs/04-development.md` / `docs/03-api.md` / （必要なら）`apps/web/*`
- 日付: 2025-12-19
- 想定所要時間: 60〜180 分

### ゴール

- **ゴール**: フェーズ10の作業開始に必要な「用語/制約/Runbook」のズレを解消し、フェーズ11〜13も“観測可能な完了条件”に寄せて、次のセッションから迷いなく進められる
  - 完了条件:
    - [x] `docs/05-00-development-phases.md` に「フェーズ10の定義（用語/制約/完了条件）」の改善が反映されている
    - [x] `docs/05-00-development-phases.md` に「フェーズ10以降の詳細計画は各フェーズ着手時に作成する（先に全部作らない）」方針が明記されている
    - [x] `docs/04-development.md` の `schedules` 登録手順が、`image_url` 必須（ダミーURL可）という運用と整合している
    - [ ] `docs/04-development.md` に「どの投稿パターンをどのカラムに登録するか」のルールと、月次更新手順・品質チェック（SQL/手動）の最小セットが追記されている
    - [ ] スケジュール表示のフォールバック（`image_url`）について、**仕様（docs）と実装（apps/web）が矛盾しない**状態になっている（どちらかに寄せる）
    - [ ] `docs/05-00-development-phases.md` のフェーズ11〜13が、主観ではなくチェック可能な完了条件（チェックリスト/手順/証跡）で表現されている
  - 補足:
    - `docs/05-10-*.md`（フェーズ10詳細計画ファイル）は、フェーズ10に実際に着手する時点で作成する（本セッションでは作成しない）

### 関連ドキュメント

- 参照: `docs/05-00-development-phases.md`（フェーズ10 / opsルール）
- 参照: `docs/02-design.md`（`schedules` テーブル定義）
- 参照: `docs/03-api.md`（ScheduleSummary / フォールバック方針）
- 参照: `docs/04-development.md`（9.6節: 運用Runbook）
- 参照: `docs/06-db-operations.md`（`image_url` はダミーURL可）
- 参照: `docs/01-requirements.md`（MVP制約・受け入れ基準）

## 前提・合意事項（事前議論・壁打ちメモ）

- 今日のセッションで前提とする方針:
  - フェーズ10〜13の詳細計画ファイル（`docs/05-10〜`）は **各フェーズに着手するタイミングで作成**する（変更が入り得るため、先に全フェーズ分は作らない）
  - フェーズ10の「スケジュールURL」は、実装/スキーマ/Runbook上は **`schedules.instagram_post_url` を基本**にした「月間スケジュール参照情報」として扱う
  - `schedules.image_url` は必須だが、暫定運用として **ダミーURL可**（後で実画像に置き換え可能）
- 保留中の論点 / 今回は触らないと決めたこと:
  - フェーズ10の詳細タスク（代表タスク例の追加、`docs/05-10-*.md` の作成）は次セッション以降（フェーズ10着手時）に実施

---

## 実装チェックリスト（本セッションにおける）

### 1. 作業タスク & 実行内容（ドキュメント更新）

- [x] タスク1: フェーズ10以降の詳細計画ファイルは「各フェーズ着手時に作成」の運用方針をドキュメントへ明記
  - 完了条件: `docs/05-00-development-phases.md` の「フェーズ9以降: 詳細計画の作り方」セクションに方針が追記されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
    - やりたいこと:
      - 「05-10〜は各フェーズ着手時に作成すればよい（先に全部作らない）」を運用方針として明記
      - 特にフェーズ10以降は変更が入りやすいので、作成後も随時更新する前提を追記
    - 制約・注意点:
      - 05-00は索引として維持しつつ、運用上の誤解が生まれない最小追記にする
    ```

- [x] タスク2: フェーズ10の「スケジュールURL」定義/制約/完了条件を観測可能に改善
  - 完了条件: `docs/05-00-development-phases.md` のフェーズ10節で、(a)用語のブレが減り、(b)制約理由が正確になり、(c)完了条件が観測可能になっている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/02-design.md
      - docs/03-api.md
      - docs/04-development.md
    - やりたいこと:
      - 「スケジュールURL」を『月間スケジュール参照情報（基本はInstagram投稿URL）』として明記
      - `facilities.instagram_url IS NULL` を対象外にする理由を「取得経路をInstagramに限定しているため」に修正
      - 完了条件を「対象施設の全件処理（登録 or 未特定/対象外を理由付きで一覧化）」など観測可能な表現へ寄せる
    - 制約・注意点:
      - 05-10詳細ファイルの作成や、フェーズ10〜13への代表タスク例の追加はこのタイミングでは行わない
    ```

- [x] タスク3: `schedules` 登録Runbookをスキーマ（`image_url` 必須・ダミーURL可）と整合
  - 完了条件: `docs/04-development.md` 9.6節の `schedules` 登録手順で `image_url` が必須として記載され、SQL例も `image_url` を含む
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/04-development.md
      - docs/06-db-operations.md
      - docs/02-design.md
    - やりたいこと:
      - Supabase Studio/SQL例に `image_url` を追加
      - 「暫定はダミーURL可」を明記し、根拠として 06-db-operations への参照を付ける
    - 制約・注意点:
      - DBスキーマ変更（マイグレーション）はしない（Runbook表現と例の整合に留める）
    ```

- [ ] タスク4: フェーズ10のRunbookを「運用できる粒度」に引き上げ（登録ルール / 月次更新 / 品質チェック）
  - 完了条件: `docs/04-development.md`（9.6節または関連節）に、最低限次が揃っている
    - 「投稿パターン → 登録先カラム」の対応表（例: 画像投稿/キャプションURL/プロフィールリンク等）
    - 月次更新のチェックリスト（いつ/何を見る/諦め条件/記録方法）
    - データ品質チェック（SQL/手動）の最小セット（重複、`published_month`、URL形式、更新漏れ）
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/04-development.md
      - docs/02-design.md
      - docs/03-api.md
      - docs/06-db-operations.md
    - やりたいこと:
      - フェーズ10の完了条件を「実務として回せるRunbook」に落とす
      - “未特定/対象外”の扱い（理由の残し方・一覧化の方法）を明記
      - 品質チェックは「最低限のSQL + 目視」で運用できる形にする
    - 制約・注意点:
      - 詳細計画（05-10）ファイルは作らない（フェーズ10着手時に作成する）
      - DBスキーマ変更が必要になりそうなら、まずはRunbookで暫定運用（`notes` や外部CSV等）を定義し、スキーマ変更は別タスクに切り出す
    ```

- [ ] タスク5: スケジュール表示フォールバック（`image_url`）の方針を確定し、docs と実装を一致させる
  - 完了条件: 次のどちらか（もしくは両方）を満たし、矛盾がなくなっている
    - A. `apps/web` が `image_url` フォールバック表示に対応し、関連テストも更新されている
    - B. 「MVPでは `image_url` をUIでは使わない」方針に寄せ、`docs/03-api.md` 等の記述も合わせて修正されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - apps/web/components/FavoriteFacilityCard.tsx
      - apps/web/components/InstagramEmbed.tsx
      - apps/web/lib/types.ts
      - apps/web/__tests__/*
      - docs/03-api.md
      - docs/01-requirements.md
    - やりたいこと:
      - “Instagram埋め込み失敗時/投稿URL未登録時”の表示ポリシーを決める（画像/リンク/空状態）
      - docs と実装のどちらを正にするか決め、差分を潰す
    - 制約・注意点:
      - 実装を触る場合、テスト追加/更新が必要（テスト観点表ルールに従う）
    ```

- [ ] タスク6: フェーズ11の完了条件を「チェック可能」に再定義（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` のフェーズ11節が、主観語を減らし、チェックリスト/証跡前提の表現に更新されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/02-design.md（UI/UXの章があれば）
      - docs/04-development.md（運用/リリースノート）
      - docs/tests/representative-flow.md
    - やりたいこと:
      - 「使ってもらえるレベル」のような主観を、チェックリスト（スマホ/PC、a11y、主要導線）に落とす
      - E2E再確認を「どのシナリオ/どのコマンド or 手順」で観測可能にする
    - 制約・注意点:
      - 05-11詳細ファイルは作らない（フェーズ11着手時に作成する）
    ```

- [ ] タスク7: フェーズ12（本番テスト&監視）を「何をどこで見るか」まで具体化（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` と `docs/04-development.md` のどちらかに、最低限次が書かれている
    - 監視（Uptime）: 対象URL/間隔/失敗時の通知先/確認手順
    - ログ: Vercel側とSupabase側で「どのログを見るか」「典型エラーの見方」
    - 公開前の漏洩チェック: 具体手順（何を確認し、証跡をどこに残すか）
    - CodeRabbit: フェーズ12に置く理由 or 置き場所の見直し
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/04-development.md
    - やりたいこと:
      - 「監視・ログ収集」を実務として回せる粒度にする（誰が見ても再現できる）
      - セキュリティ（漏洩チェック）を“やること”に分解して迷いをなくす
    - 制約・注意点:
      - 05-12詳細ファイルは作らない（フェーズ12着手時に作成する）
      - 外部サービスの導入（アカウント作成/課金）が必要なら、別タスクに切り出して“手動”扱いにする
    ```

- [ ] タスク8: フェーズ13（告知&FB）を「収集→記録→次アクション」まで最小運用に落とす（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` / `docs/04-development.md` のいずれかに、フィードバック取り扱い（受付/保管/優先付け）の最小フローが明記されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/04-development.md
      - docs/01-requirements.md（MVP完了条件）
    - やりたいこと:
      - 告知チャネル決定だけで終わらず、FBを“次に活かす”最小フロー（例: Issue化）を明記
      - MVP完了の判定手順（チェック項目/証跡）を明確化
    - 制約・注意点:
      - 05-13詳細ファイルは作らない（フェーズ13着手時に作成する）
    ```

### 2. 検証・テスト（確認方法）

- [x] 確認1: `docs/05-00-development-phases.md` のフェーズ10節を読み、用語/制約/完了条件が矛盾しないことを目視確認
      - 期待結果: 「スケジュールURL」が何を指すか、対象外の理由、完了条件が読み手に伝わる
- [x] 確認2: `docs/04-development.md` の `schedules` 登録SQL例が `image_url` 必須スキーマと矛盾しないことを目視確認
      - 期待結果: `INSERT` が `image_url` を含み、暫定でダミーURL可であることが書かれている
- [ ] 確認3: フェーズ10 Runbook（登録ルール/更新手順/品質チェック）が、1ドキュメントで追える状態になっていることを目視確認
      - 期待結果: 新規参加者でも迷わず「確認→登録→品質チェック→記録」まで辿れる
- [ ] 確認4: （実装を変更した場合）`apps/web` のテスト・Lint・型チェックが通る
      - 期待結果: `mise exec -- pnpm --filter web test` / `lint` / `typecheck` が成功する

---

## 実施ログ

- スタート: 2025-12-19
- メモ:
  - `docs/05-00-development-phases.md` に「詳細計画ファイルは各フェーズ着手時に作成でOK」を追記
  - フェーズ10の目的/完了条件/制約を、Instagram前提の実態に合わせて修正
  - `docs/04-development.md` の `schedules` 登録手順に `image_url` を追加し、ダミーURL可を明記

## 結果とふりかえり

- 完了できたタスク:
  - [x] タスク1: フェーズ10以降の詳細計画ファイル作成タイミング（各フェーズ着手時）を明記
  - [x] タスク2: フェーズ10の定義（用語/制約/完了条件）を改善
  - [x] タスク3: `schedules` 登録Runbookを `image_url` 必須運用と整合
- 未完了タスク / 想定外だったこと:
  - [ ] タスク4: フェーズ10 Runbookの実務化（登録ルール/更新手順/品質チェック）
  - [ ] タスク5: `image_url` フォールバック方針の確定と docs/実装の整合
  - [ ] タスク6: フェーズ11の完了条件をチェック可能に再定義
  - [ ] タスク7: フェーズ12（監視/ログ/漏洩チェック/CodeRabbit）を具体化
  - [ ] タスク8: フェーズ13（告知/FB運用）を最小運用に落とす
- 学び・次回改善したいこと:
  - 「スキーマ/型定義/Runbook」がズレると手動運用が詰まるため、フェーズ10開始前に整合を取っておくのは効果が高い

## 次回に持ち越すタスク

- [ ] フェーズ10の詳細計画ファイル（`docs/05-10-*.md`）を、フェーズ10着手時点の実情に合わせて作成する
  - 今回やらない理由: フェーズ10開始時点で臨機応変に変更が入り得るため、先に固定しない
  - 次回の着手条件/前提: フェーズ10の「対象範囲（対象月・対象施設）」「処理済みの定義」「未特定理由の分類」を決める

***

## 付録（任意）

- `docs/05-00-development-phases.md` の「フェーズ9以降: 詳細計画の作り方」に運用方針を追記
- `docs/05-00-development-phases.md` の「フェーズ10: スケジュールURLの全面カバー」を修正
- `docs/04-development.md` 9.6節の `schedules` 登録手順を修正
