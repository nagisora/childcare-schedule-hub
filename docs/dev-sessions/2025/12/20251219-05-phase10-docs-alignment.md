# チェックリスト式実装計画書: 2025-12-19

> **セッションとは**: このプロジェクトにおける「セッションの定義」は `docs/dev-sessions/session-definition.md` を参照。
>
> **重要（AI作業時）**: このセッションファイルは `date` コマンドで現在日付（`20251219`）を取得したうえで作成している。

## セッション概要とゴール

### 概要

- 一言サマリ: フェーズ10着手前の定義/Runbook整合に加え、フェーズ11〜13も「観測可能な完了条件」に寄せてリリースまでの迷いを減らす
- 対応フェーズ: フェーズ10（準備）/ フェーズ11〜13（準備）
- セッション種別: ドキュメント整備 + 実装準備（必要なら軽微な実装/テスト）
- 実行方式: AI自律
- 影響範囲: `docs/05-00-development-phases.md` / `docs/04-development.md` / `docs/03-api.md` / （必要なら）`apps/web/*`
- 日付: 2025-12-19
- 想定所要時間: 60〜180 分

### ゴール

- **ゴール**: フェーズ10の作業開始に必要な「用語/制約/Runbook」のズレを解消し、フェーズ11〜13も“観測可能な完了条件”に寄せて、次のセッションから迷いなく進められる
  - 完了条件:
    - [x] `docs/05-00-development-phases.md` に「フェーズ10の定義（用語/制約/完了条件）」の改善が反映されている
    - [x] `docs/05-00-development-phases.md` に「フェーズ10以降の詳細計画は各フェーズ着手時に作成する（先に全部作らない）」方針が明記されている
    - [x] `docs/04-development.md` の `schedules` 登録手順が、`image_url` 必須（ダミーURL可）という運用と整合している
    - [x] スケジュール表示方針（MVPでは `image_url` をUIで使わない）について、**仕様（docs）と実装（apps/web）が矛盾しない**状態になっている（docs側をB方針に寄せる）
    - [x] `docs/05-00-development-phases.md` のフェーズ11〜13が、主観ではなくチェック可能な完了条件（チェックリスト/手順/証跡）で表現されている
  - 補足:
    - `docs/05-10-*.md`（フェーズ10詳細計画ファイル）は、フェーズ10に実際に着手する時点で作成する（本セッションでは作成しない）

### 関連ドキュメント

- 参照: `docs/05-00-development-phases.md`（フェーズ10 / opsルール）
- 参照: `docs/02-design.md`（`schedules` テーブル定義）
- 参照: `docs/03-api.md`（ScheduleSummary / フォールバック方針）
- 参照: `docs/04-development.md`（9.6節: 運用Runbook）
- 参照: `docs/06-db-operations.md`（`image_url` はダミーURL可）
- 参照: `docs/01-requirements.md`（MVP制約・受け入れ基準）

## 前提・合意事項（事前議論・壁打ちメモ）

- 今日のセッションで前提とする方針:
  - フェーズ10〜13の詳細計画ファイル（`docs/05-10〜`）は **各フェーズに着手するタイミングで作成**する（変更が入り得るため、先に全フェーズ分は作らない）
  - フェーズ10の「スケジュールURL」は、実装/スキーマ/Runbook上は **`schedules.instagram_post_url` を基本**にした「月間スケジュール参照情報」として扱う
  - `schedules.image_url` は必須だが、暫定運用として **ダミーURL可**（後で実画像に置き換え可能）
- 保留中の論点 / 今回は触らないと決めたこと:
  - フェーズ10の詳細タスク（代表タスク例の追加、`docs/05-10-*.md` の作成）は次セッション以降（フェーズ10着手時）に実施

---

## 実装チェックリスト（本セッションにおける）

### 1. 作業タスク & 実行内容（ドキュメント更新）

- [x] タスク1: フェーズ10以降の詳細計画ファイルは「各フェーズ着手時に作成」の運用方針をドキュメントへ明記
  - 完了条件: `docs/05-00-development-phases.md` の「フェーズ9以降: 詳細計画の作り方」セクションに方針が追記されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
    - やりたいこと:
      - 「05-10〜は各フェーズ着手時に作成すればよい（先に全部作らない）」を運用方針として明記
      - 特にフェーズ10以降は変更が入りやすいので、作成後も随時更新する前提を追記
    - 制約・注意点:
      - 05-00は索引として維持しつつ、運用上の誤解が生まれない最小追記にする
    ```

- [x] タスク2: フェーズ10の「スケジュールURL」定義/制約/完了条件を観測可能に改善
  - 完了条件: `docs/05-00-development-phases.md` のフェーズ10節で、(a)用語のブレが減り、(b)制約理由が正確になり、(c)完了条件が観測可能になっている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/02-design.md
      - docs/03-api.md
      - docs/04-development.md
    - やりたいこと:
      - 「スケジュールURL」を『月間スケジュール参照情報（基本はInstagram投稿URL）』として明記
      - `facilities.instagram_url IS NULL` を対象外にする理由を「取得経路をInstagramに限定しているため」に修正
      - 完了条件を「対象施設の全件処理（登録 or 未特定/対象外を理由付きで一覧化）」など観測可能な表現へ寄せる
    - 制約・注意点:
      - 05-10詳細ファイルの作成や、フェーズ10〜13への代表タスク例の追加はこのタイミングでは行わない
    ```

- [x] タスク3: `schedules` 登録Runbookをスキーマ（`image_url` 必須・ダミーURL可）と整合
  - 完了条件: `docs/04-development.md` 9.6節の `schedules` 登録手順で `image_url` が必須として記載され、SQL例も `image_url` を含む
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/04-development.md
      - docs/06-db-operations.md
      - docs/02-design.md
    - やりたいこと:
      - Supabase Studio/SQL例に `image_url` を追加
      - 「暫定はダミーURL可」を明記し、根拠として 06-db-operations への参照を付ける
    - 制約・注意点:
      - DBスキーマ変更（マイグレーション）はしない（Runbook表現と例の整合に留める）
    ```

- [x] タスク4: スケジュール表示方針（B: MVPでは `image_url` をUIで使わない）を採用し、docs と実装の矛盾を解消する
  - 完了条件: 「MVPでは `image_url` をUIでは使わない」方針に寄せ、`docs/03-api.md` / `docs/01-requirements.md` / `docs/04-development.md` 等の記述が実装と矛盾しない状態になっている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/03-api.md
      - docs/01-requirements.md
      - docs/04-development.md
    - やりたいこと:
      - 仕様（docs）側を「MVPでは `image_url` をUIで使わない」方針に寄せる
      - そのうえで、`image_url` の位置づけ（DB必須・将来のフォールバック候補・現状は運用/検証用のダミー可）を明確化し、誤解を減らす
    - 制約・注意点:
      - MVPリリース優先のため、`apps/web` 側の実装変更は原則しない（docs側を寄せる）
    ```

- [x] タスク5: フェーズ11の完了条件を「チェック可能」に再定義（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` のフェーズ11節が、主観語を減らし、チェックリスト/証跡前提の表現に更新されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/02-design.md（UI/UXの章があれば）
      - docs/04-development.md（運用/リリースノート）
      - docs/tests/representative-flow.md
    - やりたいこと:
      - 「使ってもらえるレベル」のような主観を、チェックリスト（スマホ/PC、a11y、主要導線）に落とす
      - E2E再確認を「どのシナリオ/どのコマンド or 手順」で観測可能にする
    - 制約・注意点:
      - 05-11詳細ファイルは作らない（フェーズ11着手時に作成する）
    ```

- [x] タスク6: フェーズ12（本番テスト&監視）を「何をどこで見るか」まで具体化（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` と `docs/04-development.md` のどちらかに、最低限次が書かれている
    - 監視（Uptime）: 対象URL/間隔/失敗時の通知先/確認手順
    - ログ: Vercel側とSupabase側で「どのログを見るか」「典型エラーの見方」
    - 公開前の漏洩チェック: 具体手順（何を確認し、証跡をどこに残すか）
    - CodeRabbit: フェーズ12に置く理由 or 置き場所の見直し
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/04-development.md
    - やりたいこと:
      - 「監視・ログ収集」を実務として回せる粒度にする（誰が見ても再現できる）
      - セキュリティ（漏洩チェック）を“やること”に分解して迷いをなくす
    - 制約・注意点:
      - 05-12詳細ファイルは作らない（フェーズ12着手時に作成する）
      - 外部サービスの導入（アカウント作成/課金）が必要なら、別タスクに切り出して“手動”扱いにする
    ```

- [x] タスク7: フェーズ13（リリース告知）として、記事執筆（SEO考慮）と投稿完了までを定義する（詳細計画ファイルは作らない）
  - 完了条件: `docs/05-00-development-phases.md` / `docs/04-development.md` のいずれかに、以下が明記されている
    - 告知媒体: **X / note / Zenn / solomaker にすべて投稿する**（正本はMarkdown 1本）。各媒体にはMarkdownをコピペで展開し、**XはMarkdownからインパクトの強い箇所を抜き出して再構成**する（例: スレッド/要約ポスト）
    - リリース記事: SEOを意識したタイトル/見出し/本文の構成案（最小テンプレ）と、投稿前チェックリスト
    - 投稿完了の証跡: URL（公開先リンク）をどこに残すか（例: dev-sessions への記録）
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md
      - docs/04-development.md
      - docs/01-requirements.md（MVP完了条件）
    - やりたいこと:
      - 「MVPとして公開できる状態」→「リリース記事を執筆」→「投稿を完了」までの手順/チェックを明記
      - リリース記事はSEOを考慮した構成（タイトル/見出し/要点/リンク）を最小テンプレ化する
      - 投稿完了の証跡（公開URL）をどこに残すかを決める
    - 制約・注意点:
      - 05-13詳細ファイルは作らない（フェーズ13着手時に作成する）
    ```

- [x] タスク8: フェーズ10の定義を詳細設計ができるレベルまで詳細に記載する - 2025-12-19
  - 完了条件: `docs/05-00-development-phases.md` のフェーズ10節が、詳細設計に着手できるレベルの詳細さになっている
    - 対象範囲（対象月・対象施設）の定義が明確 ✅
    - 処理済みの定義（登録済み / 未特定 / 対象外）とその分類基準が明確 ✅
    - 未特定理由の分類（見つからない / 判断不能 / 対象外など）が明確 ✅
    - データ登録パターン（`instagram_post_url` / `image_url` / `notes` の使い分け）が明確 ✅
    - 検証方法・品質チェックの手順が具体的 ✅（品質チェックの項目（重複、URL形式、`published_month` 1日固定）が明確。具体的なSQLクエリ例は詳細計画ファイル（`docs/05-10-*.md`）で記載する前提）
  - **実施内容**:
    - `docs/05-00-development-phases.md` のフェーズ10節を大幅に更新
      - 目的を「自動取得中心」に明確化（Runbook整備はMVP後回し可）
      - 対象範囲（対象施設= `instagram_url IS NOT NULL` / 対象月=原則「現在月」）を明確化
      - 処理済みの定義（登録済み/未特定確定/対象外）と未特定理由コード（`not_found`, `ambiguous`, `not_monthly_schedule`, `story_or_highlight_only`, `account_private_or_unavailable`）を追加
      - 自動取得の方針（フェーズ9のCSE流用、固定投稿/ハイライトの扱い、フォールバック）を具体化
      - データ登録パターン（`instagram_post_url` / `image_url`(ダミー可) / `notes`）を明文化
      - 完了条件を「CLIをAIが自動実行して取れた範囲でMVP完了OK」「未特定は理由付き一覧で処理済みにする」に変更
      - 品質チェックの項目（重複、URL形式、`published_month` 1日固定）を代表タスク例に追加

- [ ] タスク9: フェーズ10の詳細計画ファイル（`docs/05-10-*.md`）を、フェーズ10着手時点の実情に合わせて作成する
  - 完了条件: `docs/05-10-*.md` が作成され、タスク8で定義した詳細設計を基に実装計画が記載されている
    - テンプレート（`docs/phase-planning/template-phase-detail.md`）に沿った構造になっている
    - タスク8で定義した対象範囲・処理済み定義・未特定理由分類が反映されている
    - 実装タスクが3〜7個程度に分解され、各タスクの完了条件・検証方法が明記されている
    - `docs/05-00-development-phases.md` のフェーズ10節に詳細計画へのリンクが追加されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/phase-planning/template-phase-detail.md
      - docs/phase-planning/phase-planning.md
      - docs/05-00-development-phases.md（フェーズ10節、タスク8で詳細化された内容）
      - docs/05-09-instagram-account-url-coverage.md（参考例）
    - やりたいこと:
      - テンプレートをコピーして `docs/05-10-*.md` を作成
      - タスク8で定義した詳細設計を基に、各セクションを埋める
      - 実装タスクを3〜7個程度に分解し、各タスクの完了条件・検証方法を明記
      - 進捗チェックリスト（0. 進捗チェックリスト（正本））を追加
      - `docs/05-00-development-phases.md` のフェーズ10節に詳細計画へのリンクを追加
    - 制約・注意点:
      - タスク8が完了していることを前提とする
      - フェーズ10着手時点の実情に合わせて調整する
    ```

### 2. 検証・テスト（確認方法）

- [x] 確認1: `docs/05-00-development-phases.md` のフェーズ10節を読み、用語/制約/完了条件が矛盾しないことを目視確認
      - 期待結果: 「スケジュールURL」が何を指すか、対象外の理由、完了条件が読み手に伝わる
- [x] 確認2: `docs/04-development.md` の `schedules` 登録SQL例が `image_url` 必須スキーマと矛盾しないことを目視確認
      - 期待結果: `INSERT` が `image_url` を含み、暫定でダミーURL可であることが書かれている
- [x] 確認3: 「MVPでは `image_url` をUIで使わない」方針に合わせて、docs（01/03/04）が矛盾なく読めることを目視確認
      - 期待結果: 読み手が「今は何をする/しない」を誤解しない
      - 確認結果: `docs/01/03/04` で `image_url` の位置づけ（DB必須・ダミー可・UI未使用）が一貫して記載されている
- [x] 確認4: フェーズ11〜13の完了条件が「チェック可能」になっていることを目視確認（主観語が減っている）
      - 期待結果: フェーズ完了の判断材料（チェックリスト/証跡/手順）が明確
      - 確認結果: フェーズ11〜13の完了条件がチェックリスト形式になり、実行手順・確認箇所・証跡が明確に記載されている

---

## 実施ログ

- スタート: 2025-12-19
- 完了: 2025-12-19
- 実施内容:
  - タスク1〜3: 前回セッションで完了済み
  - タスク4: B方針（MVPでは `image_url` をUIで使わない）で docs/01・03・04 の記述を統一
    - `docs/03-api.md`: Instagram Embed API セクションを実装に合わせて更新（`embed.js` blockquote方式、失敗時は投稿URLリンク）
    - `docs/01-requirements.md`: MVP要件の文言を「よく使う拠点ではInstagram埋め込み（失敗時リンク）中心」に更新
    - `docs/04-development.md`: `schedules` 登録Runbookとエラー対応セクションで `image_url` の位置づけを明確化
    - `docs/03-api.md`: `ScheduleSummary` の説明を更新（`image_url` はDB必須だがMVP UIでは未使用）
  - タスク5: フェーズ11の完了条件をチェック可能な項目に再定義
    - `docs/05-00-development-phases.md`: 主観表現をチェックリスト形式に分解（UI/レスポンシブ/A11y/テスト/リリースノート）
  - タスク6: フェーズ12を「実行手順・確認箇所・証跡」まで具体化
    - `docs/05-00-development-phases.md`: 完了条件をチェックリスト形式に分解（本番テスト/ログ確認/監視/CodeRabbit/漏洩チェック）
    - `docs/04-development.md`: 7.1〜7.4節を追加（ログ確認手順/監視設定/CodeRabbit導入/漏洩チェック）
  - タスク7: フェーズ13を「記事→投稿完了→証跡」まで定義
    - `docs/05-00-development-phases.md`: 完了条件をチェックリスト形式に分解し、リリース記事テンプレートを追加
  - タスク8: フェーズ10の定義を詳細設計ができるレベルまで詳細に記載
    - `docs/05-00-development-phases.md`: フェーズ10節を大幅に更新（自動取得中心、対象範囲/処理済み定義/未特定理由コード/データ登録パターン/品質チェック項目を明確化）

## 結果とふりかえり

- 完了できたタスク:
  - [x] タスク1: フェーズ10以降の詳細計画ファイル作成タイミング（各フェーズ着手時）を明記
  - [x] タスク2: フェーズ10の定義（用語/制約/完了条件）を改善
  - [x] タスク3: `schedules` 登録Runbookを `image_url` 必須運用と整合
  - [x] タスク4: スケジュール表示方針（B: MVPでは `image_url` をUIで使わない）を採用し、docs と実装の矛盾を解消
  - [x] タスク5: フェーズ11の完了条件をチェック可能に再定義
  - [x] タスク6: フェーズ12（監視/ログ/漏洩チェック/CodeRabbit）を具体化
  - [x] タスク7: フェーズ13（リリース告知）を「記事執筆（SEO考慮）→投稿完了」まで定義
  - [x] タスク8: フェーズ10の定義を詳細設計ができるレベルまで詳細に記載（対象範囲/処理済み定義/未特定理由/データ登録パターン/品質チェック項目を明確化）
- 変更したドキュメント:
  - `docs/03-api.md`: Instagram Embed API セクション、`ScheduleSummary` の説明
  - `docs/01-requirements.md`: MVP機能要件の文言
  - `docs/04-development.md`: `schedules` 登録Runbook、エラー対応、7.1〜7.4節（ログ確認/監視/CodeRabbit/漏洩チェック）
  - `docs/05-00-development-phases.md`: フェーズ10の定義（大幅更新）、フェーズ11・12・13の完了条件
- 重要な判断:
  - B方針（MVPでは `image_url` をUI表示に使わない）を採用し、docs全体で一貫性を確保
  - 外部サービスの導入（Uptime監視/CodeRabbit）は「手動作業」として別タスクに切り出す方針を明確化
  - フェーズ11〜13の完了条件を「主観」から「チェック可能（手順/証跡/コマンド）」に寄せ、次セッション以降に迷わず進められる状態に
- 学び・次回改善したいこと:
  - 「スキーマ/型定義/Runbook」がズレると手動運用が詰まるため、フェーズ10開始前に整合を取っておくのは効果が高い
  - 完了条件を「観測可能」に寄せることで、フェーズ完了の判断が明確になり、迷いが減る
- 将来の改善候補（post-MVP）:
  - フェーズ10のRunbookを「運用できる粒度」に引き上げる（登録ルール / 月次更新 / 品質チェック）
    - 現状: MVPリリース優先のため、現時点は手動運用でデータが揃っている
    - 着手条件: MVPリリース完了後、月次更新の運用負荷やデータ品質課題（更新漏れ/重複等）が顕在化したら着手
    - 回収先: `docs/20-deferred-work.md` DW-007 / Issue: #31

## 次回に持ち越すタスク

- [ ] タスク9: フェーズ10の詳細計画ファイル（`docs/05-10-*.md`）を、フェーズ10着手時点の実情に合わせて作成する

***

## 付録（任意）

- `docs/05-00-development-phases.md` の「フェーズ9以降: 詳細計画の作り方」に運用方針を追記（タスク1）
- `docs/05-00-development-phases.md` の「フェーズ10: スケジュールURLの全面カバー」を修正（タスク2）
- `docs/04-development.md` 9.6節の `schedules` 登録手順を修正（タスク3）
- `docs/03-api.md` の Instagram Embed API セクションを実装に合わせて更新（タスク4）
- `docs/01-requirements.md` の MVP機能要件を更新（タスク4）
- `docs/04-development.md` の `schedules` 登録Runbookとエラー対応を更新（タスク4）
- `docs/05-00-development-phases.md` のフェーズ11完了条件をチェックリスト形式に再定義（タスク5）
- `docs/05-00-development-phases.md` のフェーズ12完了条件をチェックリスト形式に再定義（タスク6）
- `docs/04-development.md` に7.1〜7.4節（ログ確認/監視/CodeRabbit/漏洩チェック）を追加（タスク6）
- `docs/05-00-development-phases.md` のフェーズ13完了条件をチェックリスト形式に再定義し、リリース記事テンプレートを追加（タスク7）
- `docs/05-00-development-phases.md` のフェーズ10節を大幅に更新（自動取得中心、対象範囲/処理済み定義/未特定理由コード/データ登録パターン/品質チェック項目を明確化）（タスク8）
