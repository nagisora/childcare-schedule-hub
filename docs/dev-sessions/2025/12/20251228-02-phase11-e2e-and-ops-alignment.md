# チェックリスト式実装計画書: 2025-12-28

> **セッションとは**: このプロジェクトにおける「セッションの定義」は `docs/dev-sessions/session-definition.md` を参照。
>
> **重要（AI作業時）**: このセッションファイルは `date` コマンドで現在日付（`20251228`）を取得したうえで作成している。

## セッション概要とゴール

### 概要

- 一言サマリ: フェーズ11の残タスク（E2E再確認・テスト観点表更新・デプロイ/ロールバック手順の整合性確認）を実データ前提で完了させる
- 対応フェーズ: フェーズ11
- セッション種別: 検証（E2E）/ ドキュメント整備（運用整合）
- 実行方式: ペア
- 影響範囲: `apps/web/tests/e2e/` / `apps/web/playwright.config.ts` / `docs/tests/representative-flow.md` / `docs/04-development.md`
- 日付: 2025-12-28
- 想定所要時間: 60〜240 分（上限なし）

### ゴール

- **ゴール1**: E2Eテストを「実際の施設データ + スケジュールURLが入った状態」で再実行し、主要シナリオがパスする
  - 完了条件:
    - [ ] 代表フローの E2E テストを実行できている: `mise exec -- pnpm --filter web e2e`
    - [ ] 主要シナリオ（拠点一覧表示・お気に入り追加・スケジュール表示・月切り替え）がすべてパスする
    - [ ] 失敗が出た場合は、原因（テスト/環境/実データ差分）を切り分け、再実行で収束できる状態にしている
  - 補足:
    - 実データ前提のため、データ依存で不安定になる場合は「テストの前提条件」を明文化し、安定化（待機条件/固定データの用意/モック）を検討する

- **ゴール2**: テスト観点表を更新し、実データでの動作確認結果を記録する
  - 完了条件:
    - [ ] `docs/tests/representative-flow.md` を更新し、実行日・対象環境・結果（Pass/Fail、補足）を記録している
    - [ ] 追加で必要と判明した観点（実データ特有の分岐/境界値）があれば、表に追記できている

- **ゴール3**: デプロイ/ロールバック手順が「現状の運用」と一致していることを確認し、差分があれば更新する
  - 完了条件:
    - [ ] `docs/04-development.md` の「デプロイと運用」（7章）の記載が現状と一致している（差分があれば更新）
    - [ ] `docs/04-development.md` の「運用 Runbook」（9章）のロールバック手順が現状と一致している（差分があれば更新）
    - [ ] 上記の確認/更新結果を dev-sessions（本ファイル）に証跡として記録している

### 関連ドキュメント

- 参照:
  - `docs/05-00-development-phases.md`（フェーズ11 291-298）
  - `docs/tests/representative-flow.md`（代表フローのテスト観点表）
  - `apps/web/tests/e2e/favorites-flow.spec.ts`（代表フローE2E）
  - `docs/04-development.md`（7章: デプロイと運用 / 9章: 運用 Runbook）
  - `apps/web/tests/README.md`（E2Eの実行メモがあれば参照）

## 前提・合意事項（事前議論・壁打ちメモ）

- 今日のセッションで前提とする方針:
  - フェーズ11のこのセッションは「実データ前提の検証」と「運用ドキュメントの整合確認」が目的
  - E2Eはまず現状のまま実行し、失敗時に最小差分で安定化する（闇雲に待機を伸ばさない）
  - シークレット/個人情報（URL・トークン等）を dev-sessions に書かない
- 議論概要:
  - Vercelは随時デプロイしており、DBも本番と同じものを使っているため、「追記する」より「現状と一致するか確認」に寄せる方針
- 保留中の論点 / 今回は触らないと決めたこと:
  - UIデザインの修正（272-290）は別セッションで対応する（`20251228-01-...`）

---

## 実装チェックリスト（本セッションにおける）

### 1. 作業タスク & 実行内容（実装・ドキュメント更新）

- [ ] タスク1: 代表フローの E2E テストを実データ状態で実行し、主要シナリオがパスすることを確認する
  - 完了条件: `mise exec -- pnpm --filter web e2e` が成功し、主要シナリオがすべてパスしている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md（フェーズ11 291-294）
      - apps/web/playwright.config.ts
      - apps/web/tests/e2e/favorites-flow.spec.ts
      - docs/04-development.md（5.2 pnpmスクリプト / 5.6 テスト戦略）
    - やりたいこと:
      - まずE2Eを実行し、成功/失敗を記録する
      - 失敗時はログ/スクリーンショット/トレースを見て原因を切り分ける（テスト側の待機、データ依存、環境変数、UI変更など）
      - 必要ならテストを最小限更新し、再実行で収束させる
    - 実行コマンド:
      - mise exec -- pnpm --filter web e2e
    - 制約・注意点:
      - 対話が必要な操作（認証情報入力/課金など）はしない
      - 失敗時にシークレットがログに混ざらないよう注意する（貼り付ける場合はマスクする）
    ```

- [ ] タスク2: テスト観点表（`docs/tests/representative-flow.md`）を更新し、実データでの動作確認結果を記録する
  - 完了条件: `docs/tests/representative-flow.md` に「今回の実行結果」が追記され、必要な観点追加が反映されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/tests/representative-flow.md
      - docs/05-00-development-phases.md（フェーズ11 292-294）
    - やりたいこと:
      - 実行日・実行環境（ローカル/Preview/Production等）・結果を、観点表に追記する
      - 実データで初めて見えた分岐（例: スケジュール未登録、埋め込み失敗フォールバック等）があれば観点として追加する
    - 制約・注意点:
      - 本番URLや個人情報が含まれる場合は、公開可能な範囲に留める（必要なら伏せ字/一般化）
    ```

- [ ] タスク3: デプロイ/ロールバック手順の整合性を確認し、差分があれば `docs/04-development.md` を更新する
  - 完了条件: `docs/04-development.md` の7章/9章が現状運用と一致し、確認/更新結果が本ファイルに記録されている
  - **AIが実行する内容（手順/プロンプト/操作メモ）**:
    ```
    - 参照ファイル:
      - docs/05-00-development-phases.md（フェーズ11 295-298）
      - docs/04-development.md（7章: デプロイと運用 / 9章: 運用 Runbook）
    - やりたいこと:
      - 現状の運用（Vercel随時デプロイ、DBは本番共用）とドキュメント記載を突き合わせる
      - 差分がある場合は、表現を「追記」ではなく「確認/更新」に寄せて修正する
      - 変更した場合は、影響範囲と注意点（ロールバック時の判断/手順）を短く明文化する
    - 制約・注意点:
      - 実際の本番操作（Vercel/Supabaseの画面操作）は、このドキュメント整備では行わない（必要なら手動作業として切り出す）
    ```

### 2. 検証・テスト（確認方法）

- [ ] 確認1: E2E を実行する
      - 期待結果: `mise exec -- pnpm --filter web e2e` が成功し、主要シナリオがパスする
- [ ] 確認2: 観点表を更新し、記録が残っている
      - 期待結果: `docs/tests/representative-flow.md` に実行結果と補足が追記されている
- [ ] 確認3: 運用ドキュメントの整合性確認結果が本セッションに記録されている
      - 期待結果: `docs/04-development.md` の7章/9章の差分有無と、必要な更新が記録されている

---

## 実施ログ

- スタート:
- メモ:
  - TODO: E2E 実行結果（Pass/Fail）とログ/トレースの保存先
  - TODO: 観点表へ追記した内容の要約
  - TODO: `docs/04-development.md` の差分有無（更新したなら該当セクション）を記録

## 結果とふりかえり

- 完了できたタスク:
  - [ ] （セッション終了時に更新）
- 未完了タスク / 想定外だったこと:
  - [ ] （セッション終了時に更新）
- 学び・次回改善したいこと:
  - 

## 次回に持ち越すタスク

- [ ] フェーズ11（デザイン修正）: UIデザイン一貫性/レスポンシブ/A11y の改善（`docs/05-00-development-phases.md` 272-290）
  - 今回やらない理由: セッションを「それ以外」と分割して集中するため
  - 次回着手条件: `docs/dev-sessions/2025/12/20251228-01-phase11-design-polish.md` を開始する

***

## 付録（任意）

- 抜粋（正本）: `docs/05-00-development-phases.md` フェーズ11（291-298）


