# 2025-11-16 セッション 02（フェーズ1: 要件具体化・現状整理）

## フェーズ / 目的
- フェーズ: 1 要件の具体化（MVP スコープ確定）
- 目的:
  - `docs/01-04`（v0.2.0）と前回セッションの成果を読み合わせ、MVP/ポストMVP・技術前提のズレを棚卸し
  - 「拠点一覧 → スケジュール表示 → お気に入り」の主要フローに対する要件の現状整理

## 現状整理メモ（01/02/03/04 の読み合わせ）
- Next.js バージョン表記
  - 02/03/04: Next.js 14 表記が残存
  - セッション01・実プロジェクト: Next.js 15（App Router）を利用
  - 影響: 01 の制約条件（章10）を Next.js 15 に更新。02/03 の記述も後続で表記整合が必要
- お気に入り機能（MVP）
  - 01/03: クッキーで拠点 ID を保存（最大30件）、並び替え固定を行う方針は一致
  - 02: 状態管理方針・UI チェックリストに一致する記述あり。MVPでは DB `favorites` は導入しない前提で問題なし
- スケジュール表示
  - 01: 画像 or Instagram 埋め込み（手動投入で対応）
  - 03: oEmbed 安全化の方針を明示（サニタイズ、SDK 遅延読込、iframe sandbox）
  - 02: キャッシュ/UX（プレースホルダ・フォールバック）記述あり。整合 OK
- 非機能・運用
  - 01: LCP p75 < 2.5s / ISR 60分 / A11y 要件 / セキュリティ・運用要件が明文化済み
  - 04: 開発ガイドの実運用は mise 前提で整備済み。Next.js 15 相当の文言は後続で微修正が必要

## ズレ・疑問点
1. 01「制約条件」の Next.js 14 → 15 への更新（セッション01の実績に合わせる）
2. 6.1/7.1/9/12 の表現を、主要フロー（一覧→スケジュール→お気に入り）とアウトオブスコープをより明確にする
3. クッキー仕様（03に詳細あり）の抜粋を 01 の 7.1/12 へ要点追記（最大件数・属性・注意）

## あなたへの共有（チェックポイント予定）
- チェックポイント1: 01 の 6.1/7.1/9/12 ドラフト後に、MVP スコープ/アウトオブスコープの最終確認
- チェックポイント2: 主要フローの画面構成（文面レベルの骨格）に対するUXレビュー

## 02/03/04 への更新候補リスト（差分抽出のみ）
- docs/02-design.md
  - 表記の更新: Next.js 14 → 15（2.1、6. 技術選定理由）
  - 画面構成: 主要フローの用語とチェックリストの項目名を 01 に合わせ微調整
- docs/03-api.md
  - 参照元の整合: 01 のスコープ確定語彙に合わせた表記見直し（クッキー仕様の引用箇所の注釈強化。「同期はポストMVP」明記）
  - エンドポイント例は現状のままで問題なし（MVPは読み取り中心）
- docs/04-development.md
  - Next.js 15 相当の言及に軽微な表記整合
  - 開発時の確認項目（ISR/再検証・A11y・Lighthouse）の頻度/表記を 01 と合わせる

## 結果
- 01/02/03/04 の整合に大きな矛盾はなし。主な更新は「Next.js 15 への表記統一」と「01 の主要フロー・アウトオブスコープの明確化」。

## 持ち越し
- 01（6.1/7.1/9/12）のドラフト更新 → チェックポイント1でレビュー
- 非機能・制約・リスクの微調整（表現統一・現実運用の補足）

## フェーズ1完了セルフチェック
- [x] `01` に MVP のユーザーストーリー / 受け入れ基準が明文化されている
- [x] `02/03/04` への更新ポイント（候補リスト）が一覧化されている
- [x] 主要フロー（一覧→スケジュール→お気に入り）に関する「やる/やらない」が明記された
- [x] 01 の制約条件を Next.js 15 に更新
- [x] クッキー仕様の要点（上限/属性/非同期）を 01 に明示



## 追記（フェーズ1完了の記録）
- 実施差分（本ブランチ）:
  - `docs/01-requirements.md`: MVP 方針を「お気に入り5件・一覧はテキスト表・画像/埋め込みはお気に入り＋将来詳細」に更新。受入基準も整合。
  - `docs/02-design.md`: トップ構成（お気に入り5件＋テキスト表＋+ボタン）と、拠点詳細（ポストMVP）への画像/埋め込み集約を追記。
  - `docs/03-api.md`: MVP トップでの利用範囲を注記（facilities 基本フィールドのみ／schedules はお気に入り＋詳細）。
  - `apps/web/app/page.tsx`: 上記方針の UI モックを実装。アクセス性向上のため、エリア内リンクとグルーピングを追加。
  - `apps/web/components/*`: 責務分離（Hero/Favorites/FacilitiesTable）で可読性・拡張性を向上。
- 次フェーズ移行に向けたメモ:
  - Supabase 連携（facilities 取得／クッキーお気に入り最大5件／+・解除ボタンの動作）
  - 必要時に Zod を導入し、レスポンスとクッキーJSONをランタイム検証
  - `docs/04-development.md` の Next.js 15 表記の微整合はフェーズ2で実施
