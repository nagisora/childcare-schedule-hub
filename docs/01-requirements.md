# 01 要件定義

## 1. ドキュメント情報
| 項目 | 内容 |
| --- | --- |
| バージョン | 0.2.0 |
| 最終更新日 | 2025-11-14 |
| 作成責任者 | Childcare Schedule Hub プロジェクトチーム |
| 対象読者 | プロダクトオーナー、設計/開発チーム、新規参加メンバー |
| 推奨読了順 | 本書 → [02 設計資料](./02-design.md) → [03 API 仕様](./03-api.md) → [04 開発ガイド](./04-development.md) |

本書はプロダクトの要件を単一ソースとして定義し、設計・API・開発手順の詳細は各ドキュメントを参照する。更新時は関連ドキュメントとの整合を必ず確認すること。

## 2. プロジェクト概要
- 名称: 子育て拠点スケジュールハブ (Childcare Schedule Hub)
- 目的: 名古屋市内の子育て応援拠点・地域子育て支援拠点（以下、まとめて「拠点」）のスケジュール情報を一元的に閲覧できる Web アプリを提供する。
- 主要価値: 拠点情報の探索性向上、利用頻度の高い拠点への迅速アクセス、運用者の更新負担を軽減する情報管理基盤。
- 対象ユーザー:
  - 幼児を持つ保護者
  - 妊娠中の方
  - 子育て支援を行う団体・行政担当者

## 3. 背景と参考情報
- 名古屋市子育て応援拠点一覧 [[1]](#ref1)
- 名古屋市地域子育て支援拠点一覧 [[2]](#ref2)
- 開発プロセスおよびパフォーマンス最適化に関する知見 [[3]](#ref3)[[4]](#ref4)
- 詳細なデザイン・API・開発手順はそれぞれ [02 設計資料](./02-design.md)、[03 API 仕様](./03-api.md)、[04 開発ガイド](./04-development.md) を参照。

- プロダクトオーナー: Childcare Schedule Hub プロジェクト代表
- 利用者: 名古屋市在住の保護者・支援者
- 運用者: 拠点運営担当およびコンテンツ更新担当
- 技術協力: 開発チーム、OSS コミュニティ、LLM 支援

## 5. ペルソナと利用シナリオ
- **ペルソナA: 共働き世帯の保護者（30代）**  
  - 平日に仕事をしながら週末のイベントを探す。スマートフォンから空き時間に閲覧し、よく利用する拠点をお気に入りに登録しておきたい。
- **ペルソナB: 初めて出産を迎える妊娠中の方（20代）**  
  - 妊娠期から利用できる支援拠点を探し、所在地や連絡先、開催スケジュールを確認したい。レスポンシブ対応で読みやすいレイアウトを求める。
- **ペルソナC: 子育て支援ボランティア（40代）**  
  - 自身が担当するイベントの日時を把握し、別拠点のプログラムも横断的にチェックしたい。PC からの閲覧が中心。

## 6. フェーズ構成
本プロダクトは MVP とポストMVP の 2 段階で拡張する。各フェーズの詳細要件は次章で定義し、設計や実装は関連ドキュメントを参照する。

### 6.1 MVP フェーズ
- 拠点一覧と基本情報を提供し、運用者が手動登録したスケジュール画像または Instagram 埋め込みを表示する（自動連携はポストMVP）。
- ブラウザlocalStorageでお気に入り拠点（最大5件）を保存し、トップページ上部に固定・並び替えて表示する（DB 同期はポストMVP）。
- 非ログイン前提での利用に最適化し、モバイル優先のレスポンシブ UI を提供する（Next.js 15 / App Router 前提）。

### 6.2 ポストMVP フェーズ
- 認証済みユーザーと運用者向け機能（ログイン、拠点登録/編集、通知）を追加する。
- Instagram API や AI を活用した自動スケジュール更新や高度な検索・フィルター機能を導入する。
- マルチテナント対応や分析基盤を見据えたデータモデル拡張を行う。

## 7. 機能要件
各要件は設計・API・開発ガイドと双方向に参照し、仕様の重複や矛盾を避ける。

### 7.1 MVP 機能要件
1. トップページに拠点一覧を表示し、名称・エリア・連絡先をテキストの表形式で提示する（スケジュール画像/埋め込みは表示しない）。
2. 「よく使う拠点」は最大5件を表示対象とし、将来的にこのエリアでのみスケジュール画像/埋め込みを表示する（MVPではプレースホルダ可）。
3. お気に入り機能はlocalStorageで拠点 ID と `sortOrder` を保存し、並び替え・固定表示を行う。最大5件、JSON 形式（[03 API 仕様](./03-api.md) のlocalStorage要件と一致）。
4. レスポンシブレイアウトを適用し、モバイル優先で可読性・操作性を確保する（表はモバイルで縦積みレイアウトに崩す）。
5. エンプティステート・エラーメッセージ・アクセシビリティ（A11y）要件を満たす（[02 設計資料](./02-design.md) の UI チェックリストに準拠）。

### 7.2 ポストMVP 機能要件
1. NextAuth.js + Supabase Auth によるユーザー認証と、お気に入り情報のマルチデバイス同期。
2. 拠点管理 UI（登録、スケジュール更新、連絡先管理）および管理者権限によるユーザー管理。
3. Instagram API と AI による自動スケジュール収集、通知・検索・フィルター機能の追加。
4. CSV/JSON エクスポートや分析用 API の提供。
5. 将来的な複数都市展開を想定したマルチテナント拡張。

## 8. 非機能要件
各指標は「目標値」と「検証手段」のペアで定義し、詳細な実行手順は [04 開発ガイド](./04-development.md) を参照する。

### 8.1 パフォーマンス
| 目標値 | 検証手段 |
| --- | --- |
| コアページの LCP 2.5 秒以内（3G 相当回線, モバイル端末） | ホスティング基盤（現状: Vercel） + Lighthouse CI による定期計測（[04 開発ガイド](./04-development.md) の品質チェック参照） |
| 拠点一覧の初回描画 < 3 秒、以降の表示は ISR で 1 秒以内 | ISR 再検証ログと Web Vitals 計測、[02 設計資料](./02-design.md) のキャッシュ戦略に従う |

補足:
- KPI は **LCP p75 < 2.5 秒**（4G / 中位帯スマートフォン / トップ・拠点一覧ページ）を維持する。
- Lighthouse CI とホスティング基盤のパフォーマンス計測ツール（現状: Vercel Speed Insights）を月次でレビューし、閾値超過時は改善タスクを起票する。
- ISR（Incremental Static Regeneration）は 60 分で再生成し、Supabase Edge キャッシュを活用して再取得を最小化する。

### 8.2 アクセシビリティ
| 目標値 | 検証手段 |
| --- | --- |
| 主要機能をキーボード操作のみで利用可能 | Storybook + Axe による回帰チェック |
| 代替テキスト・ARIA 属性の網羅 | [02 設計資料](./02-design.md) の UI チェックリストを用いたレビュー |
| コントラスト比 4.5:1 以上 | Lighthouse / axe-core レポートでの自動検証 |

### 8.3 セキュリティ
| 目標値 | 検証手段 |
| --- | --- |
| 機密情報を `.env.local` に保管し、リポジトリ非公開 | PR テンプレートでのレビュー確認 |
| localStorageは同一オリジン内で共有され、クライアント側のみでアクセス可能 | [03 API 仕様](./03-api.md) のlocalStorage章に沿った設定レビュー |
| Supabase RLS で不要なデータアクセスを禁止 | Supabase Policy テストと手動レビュー |

補足:
- お気に入り用localStorageは有効期限180日（タイムスタンプで管理）とし、クライアント側でのみ読み書き可能。PII は保持しない。

### 8.4 運用性
| 目標値 | 検証手段 |
| --- | --- |
| CI/CD による自動デプロイと段階的ロールアウト（現状: Vercel、本番デプロイ先はフェーズ8で再検討） | GitHub Actions ワークフロー（[04 開発ガイド](./04-development.md)） |
| Supabase バックアップと障害復旧手順の整備 | 月次テスト復元、運用 Runbook の更新 |

補足:
- 稼働 SLO は 99.9% を目標とし、Supabase のバックアップ設定を有効化して RPO 24 時間以内 / RTO 4 時間以内を維持する。
- 障害時の復旧手順を Runbook にまとめ、定期演習を実施する。

## 9. ユーザーストーリー（MVP）
1. 保護者として、よく利用する拠点の最新スケジュールをトップページで素早く確認したい（画像 or 埋め込みが即時に視認できる）。
2. 保護者として、お気に入り登録した拠点を一覧上部に固定し、並び替えてすぐにアクセスしたい（localStorageで維持）。
3. 支援団体として、新しい拠点の所在地や連絡先を検索し、問い合わせたい（最低限の連絡先表示）。

### 9.1 MVP 代表ユーザーフロー（拠点一覧 → スケジュール表示 → お気に入り）

このプロダクトの代表フローは、モバイル端末からトップページにアクセスした保護者が、拠点一覧から気になる拠点を見つけ、よく利用する拠点をお気に入りとして固定し、その拠点のスケジュールを素早く確認できる一連の流れである。MVP ではスケジュール画像/埋め込みの表示は「よく使う拠点」エリアを中心に段階的に導入し、一覧テーブル上には表示しない。

- ステップ概要:
  - ユーザー（主にペルソナA/B）はスマートフォンからトップページ（拠点一覧 + よく使う拠点）を開く。
  - 拠点一覧（テキスト表）からよく利用する拠点を最大 5 件までお気に入りに追加し、トップページ上部の「よく使う拠点」エリアに固定する。
  - 「よく使う拠点」エリアから各拠点のスケジュール（画像/埋め込み、もしくはプレースホルダー）へアクセスし、開催予定を確認する（詳細ページやポストMVP機能への導線を含む）。

## 10. 制約条件
- 技術スタックは Next.js 15（App Router）、Supabase を基本とする。
- ホスティング基盤は仮MVP環境として Vercel を利用しているが、本番デプロイ先は [フェーズ8: デプロイ先の検討（コスト最適化）](./05-development-phases.md#フェーズ8-デプロイ先の検討コスト最適化) で再検討する（候補: Cloudflare Pages など）。
- ホスティングやデータベースは可能な限り無料枠内で運用し、超過時の移行計画を事前に検討する。
- GitHub リポジトリは公開であるため、個人情報や機密情報を含めない。

## 11. リスクと対応策
| リスク | 影響 | 対応策 | 関連ドキュメント |
| --- | --- | --- | --- |
| Instagram oEmbed 仕様変更 | スケジュール表示停止 | 公式 Embed API をウォッチし、画像ホスティングへの切替手順を用意 | [03 API 仕様](./03-api.md) |
| Supabase 無料枠上限超過 | データ取得不可・サービス停止 | メトリクス監視と有料プラン切替判断を定期レビュー | [04 開発ガイド](./04-development.md) |
| Supabase Edge Functions 運用リスク | 自動更新機能停止・高コスト | ポストMVP では段階導入し、ロールバック手順を整備 | [02 設計資料](./02-design.md) |
| localStorage依存によるお気に入り同期不足 | デバイス間での体験不一致 | MVP の制約として明示し、認証導入時に DB 同期へ移行 | [03 API 仕様](./03-api.md) |
| Instagram API のレート制限・TOS 変更 | oEmbed 取得失敗・利用停止 | Graph API のアップデートを監視し、フォールバック画像や事前キャッシュで影響を緩和 | [03 API 仕様](./03-api.md) |
| 埋め込み失敗による UX / SEO 低下 | ページ表示劣化・離脱増 | サニタイズ済み HTML とフォールバック `<img>` を必須化し、失敗ログを監視 | [02 設計資料](./02-design.md) |

## 12. MVP 受け入れ基準
- 表示要件: トップページで「よく使う拠点（最大5件）」と「全拠点一覧（テキスト表＋お気に入り追加ボタン）」が閲覧・操作できる。
- A11y 要件: キーボード操作とスクリーンリーダーで主要フローが操作可能である。
- パフォーマンス: LCP p75 < 2.5 秒を達成し、測定レポートを残す。
- データ要件: お気に入りはlocalStorage（最大5件、有効期限180日）で保持され、デバイス間で同期しない旨を UI 上に明示する。
- アウトオブスコープ: 多言語対応、ログイン機能、通知機能、CSV 出力、AI 自動連携、DB `favorites` の同期、一覧でのスケジュール画像/埋め込み表示。

## 13. 用語集
- **拠点**: 名古屋市が提供する子育て応援拠点または地域子育て支援拠点。データソースは [[1]](#ref1)[[2]](#ref2)。
- **スケジュール**: Instagram 投稿または Supabase に保存された画像で提供されるイベント予定。
- **MVP**: Minimum Viable Product。最小限の価値を提供する初期リリース。
- **ポストMVP**: MVP 後に段階的に実装する将来機能。優先順位はプロダクトロードマップで調整する。

## 14. 参考文献
- <a id="ref1"></a>[1] 名古屋市子育て応援拠点一覧, https://www.kosodate.city.nagoya.jp/play/ouenkyoten.html
- <a id="ref2"></a>[2] 名古屋市地域子育て支援拠点一覧, https://www.kosodate.city.nagoya.jp/play/supportbases.html
- <a id="ref3"></a>[3] Jun Ito, 『みらい まる見え政治資金』を支える技術, https://note.com/jujunjun110/n/nee305ca004ac
- <a id="ref4"></a>[4] Jun Ito, どのようにして95%以上のコードをLLMに書かせることができたのか, https://note.com/jujunjun110/n/na653d4120d7e
