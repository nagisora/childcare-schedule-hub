# 01 要件定義

## 1. プロジェクト概要
- 名称: 子育て拠点スケジュールハブ (Childcare Schedule Hub)
- 目的: 名古屋市内の子育て応援拠点・地域子育て支援拠点のスケジュール情報を一元的に閲覧できる Web アプリを提供する。
- 対象ユーザー:
  - 幼児を持つ保護者
  - 妊娠中の方
  - 子育て支援を行う団体・行政担当者

## 2. 背景と参考情報
- 名古屋市子育て応援拠点一覧 [[1]](#ref1)
- 名古屋市地域子育て支援拠点一覧 [[2]](#ref2)
- 開発プロセスおよびパフォーマンス最適化に関する知見 [[3]](#ref3)[[4]](#ref4)

## 3. ステークホルダー
- プロダクトオーナー: ユーザー本人
- 利用者: 名古屋市在住の保護者・支援者
- 運用者: 管理者（拠点情報・スケジュール管理）
- 技術協力: OSS コミュニティ、LLM 支援

## 4. ペルソナと利用シナリオ
- **ペルソナA: 共働き世帯の保護者（30代）**  
  - 平日に仕事をしながら週末のイベントを探す。スマートフォンから空き時間に閲覧し、よく利用する拠点をお気に入りに登録しておきたい。
- **ペルソナB: 初めて出産を迎える妊娠中の方（20代）**  
  - 妊娠期から利用できる支援拠点を探し、所在地や連絡先、開催スケジュールを確認したい。レスポンシブ対応で読みやすいレイアウトを求める。
- **ペルソナC: 子育て支援ボランティア（40代）**  
  - 自身が担当するイベントの日時を把握し、別拠点のプログラムも横断的にチェックしたい。PC からの閲覧が中心。

## 5. スコープと段階
- **MVP フェーズ**
  - 拠点一覧表示（名称、所在地、連絡先）
  - スケジュール画像の表示（手動登録）
  - Instagram 埋め込みによるスケジュール提示
  - クッキーを用いたお気に入り登録と並び替え
- **ポスト MVP**
  - ユーザー登録・ログイン
  - 管理者機能（拠点登録、ユーザー管理）
  - Instagram 自動巡回と AI 画像認識によるスケジュール更新
  - 検索・フィルター機能、通知機能

## 6. 機能要件
### 6.1 MVP 機能要件
1. 拠点一覧ページをトップに配置し、拠点名・エリア・連絡先を表示する。
2. 各拠点カードで最新のスケジュール画像または Instagram 埋め込みを表示する。
3. スケジュール画像は管理画面未実装の間、手動入力（Supabase 直接投入）で対応する。
4. お気に入り登録はクッキーで拠点 ID を保持し、トップ上部に固定表示および並べ替えを可能にする。
5. レイアウトはスマートフォン・タブレット・PC で最適化されたレスポンシブ対応とする。

### 6.2 将来機能要件
1. ユーザー認証（NextAuth.js + Supabase Auth）
2. 管理画面（拠点登録、スケジュール更新、ユーザー管理）
3. Instagram API と AI（画像認識）での自動リンク更新
4. CSV 出力などのデータ透明性向上機能
5. マルチテナント対応を意識した拡張性の高いデータモデル

## 7. 非機能要件
### 7.1 パフォーマンス
- パフォーマンス指標は **LCP p75 < 2.5 秒**（4G / 中位帯スマートフォン / トップ・拠点一覧ページ）とする。
- Lighthouse CI および Vercel Speed Insights を用いて月次で測定し、閾値を超える場合は改善チケットを起票する。
- ISR（Incremental Static Regeneration）は 60 分で再生成し、サーバーコンポーネント／Supabase Edge キャッシュを活用して再取得を最小化する。

### 7.2 アクセシビリティ
- キーボード操作のみで主要機能を利用可能にする。
- スクリーンリーダー向けに代替テキストと ARIA 属性を適切に付与する。
- カラコントラスト比 4.5:1 以上を確保する。

### 7.3 セキュリティ
- Supabase API キーや環境変数は `.env.local` に保持し、リポジトリに含めない。
- お気に入り用クッキーは `Secure; SameSite=Lax; Path=/; Max-Age=15552000`（180 日）を付与し、HttpOnly は付与しない（クライアント側で読み書きが必要なため）。PII は保持しない。
- RLS (Row Level Security) を用いて不要なデータアクセスを制限する。

### 7.4 運用性
- GitHub Actions または Vercel 上でデプロイを自動化する。
- 稼働 SLO は 99.9% とし、Supabase のバックアップ設定を有効化して RPO 24 時間以内 / RTO 4 時間以内を目標とする。
- 障害時の復旧手順を Runbook にまとめ、定期的に演習する。

## 8. ユーザーストーリー（MVP）
1. 保護者として、いつでも好きな拠点のスケジュールを確認したい。
2. よく利用する拠点をお気に入り登録し、トップにまとめて表示したい。
3. 新しい拠点を見つけた際に、所在地や連絡先をすぐに確認したい。

## 9. 制約条件
- 技術スタックは Next.js 14 + Supabase + Vercel を基本とする。
- ホスティングや DB は無料枠内で運用する。
- GitHub リポジトリはオープン公開されるため、機密情報を含めない。

## 10. リスクと対応策
| リスク | 影響 | 対応策 |
| --- | --- | --- |
| Instagram 埋め込みの仕様変更 | スケジュール表示停止 | 公式 Embed API の仕様をウォッチし、代替画像ホスティングを用意する |
| Supabase 無料枠上限超過 | サービス停止 | メトリクス監視、必要時に有料プラン切替を検討 |
| お気に入り情報のクッキー依存 | マルチデバイス同期不可 | MVP と割り切り、将来的にユーザー認証連携を実装 |
| Instagram API のレート制限・TOS 変更 | oEmbed 取得失敗・利用停止 | Graph API のアップデートを監視し、フォールバック画像や事前キャッシュで影響を緩和する |
| 埋め込み失敗による UX / SEO 低下 | ページ表示劣化・離脱増 | サニタイズ済み HTML とフォールバック `<img>` を必須化し、失敗ログを監視する |

## 11. MVP 受け入れ基準
- 表示要件: 拠点一覧で全拠点の名称・エリア・連絡先・最新スケジュールが閲覧できる。
- A11y 要件: キーボード操作とスクリーンリーダーで主要フローが操作可能である。
- パフォーマンス: LCP p75 < 2.5s を達成し、測定レポートを残す。
- データ要件: お気に入りクッキーがデバイス内で保持されることを UI 上で明示する。
- アウトオブスコープ: 多言語対応、ログイン機能、通知機能、CSV 出力、AI 自動連携。

## 12. 用語集
- **拠点**: 名古屋市が提供する子育て応援拠点または地域子育て支援拠点
- **スケジュール**: Instagram 投稿または画像ファイルとして提供されるイベント予定
- **MVP**: Minimum Viable Product。最小限の価値を提供する初期リリース

## 13. 参考文献
- <a id="ref1"></a>[1] 名古屋市子育て応援拠点一覧, https://www.kosodate.city.nagoya.jp/play/ouenkyoten.html
- <a id="ref2"></a>[2] 名古屋市地域子育て支援拠点一覧, https://www.kosodate.city.nagoya.jp/play/supportbases.html
- <a id="ref3"></a>[3] Jun Ito, 『みらい まる見え政治資金』を支える技術, https://note.com/jujunjun110/n/nee305ca004ac
- <a id="ref4"></a>[4] Jun Ito, どのようにして95%以上のコードをLLMに書かせることができたのか, https://note.com/jujunjun110/n/na653d4120d7e
