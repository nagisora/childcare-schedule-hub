# 05 開発フェーズ（少ない時間で前進するための道しるべ）

本書は、短時間の作業でも迷わず進められるように、開発フェーズを高レベルで定義する。各フェーズの詳細作業は `docs/dev-sessions/` のテンプレートを用いてセッション単位に分割・記録する。

関連: `docs/04-development.md`（日々の開発/運用ガイド）、`docs/dev-sessions/template-session.md`（作業テンプレ）

---

## 必読：運用ルール（要点）

**作業を始める前に必ず確認してください**。詳細は[運用ルール（フェーズ × セッション）](#ops-rules)を参照。

- 新しいタスクを始めるときは、まず属するフェーズを1つ選ぶ（上記のフェーズ一覧から）
- 1回の作業は15〜60分程度を目安に、`docs/dev-sessions/template-session.md` をコピーしてセッションを進める
- dev-sessions ファイル作成時は、**必ず `date` コマンドで現在日付を取得**し、その日の既存ファイルを確認してから連番を決定する（詳細は[dev-sessions ファイルの日付の付け方](#dev-sessions-date)を参照）
- フェーズ完了時は関連ドキュメント（01〜04）を必要最小限で更新し、相互リンクを保つ
- フェーズ9以降は、詳細計画は `docs/05-<フェーズ番号>-*.md` 形式の専用ファイルに切り出す（このファイルは索引として、各フェーズの「目的 / 主に触るドキュメント / 完了条件 / 代表タスク例」のみを持つ）

---

## フェーズ一覧
- フェーズ1: 準備・要件の具体化（環境 / ドキュメント / MVP スコープ確定）
- フェーズ2: 設計・API の整備
- フェーズ3: 実装スプリント（UI/機能）
- フェーズ4: ローカルテスト / UI調整（骨格）
- フェーズ5: 施設情報データ取得・投入フロー
- フェーズ6: Instagram 連携 & お気に入りでのスケジュール埋め込み
- フェーズ7: 仮MVP環境のVercelデプロイ
- フェーズ8: 仮MVP環境のクオリティアップ
- フェーズ9: InstagramアカウントURLの全面カバー
- フェーズ10: スケジュールURLの全面カバー
- フェーズ11: デザイン / UX 仕上げ & リリース準備
- フェーズ12: デプロイ先の検討（コスト最適化）
- フェーズ13: 本番テスト & 監視セットアップ
- フェーズ14: リリース告知 & MVP完了

---

## フェーズ1: 準備・要件の具体化（環境 / ドキュメント / MVP スコープ確定）
- 目的: ローカル開発が即開始でき、主要ドキュメントが参照可能な状態を作り、MVP の機能・非機能・受け入れ基準を合意し、優先順位を固定する
- 主に触るドキュメント: `00` / `01` / `04`
- 完了条件:
  - `pnpm dev --filter apps/web` でローカル起動できる
  - `00/04` に沿って初見でも開発を始められるリンク導線がある
  - MVP のユーザーストーリー / 受け入れ基準が明文化されている
  - 影響する `02/03/04` の更新ポイントが洗い出されている

## フェーズ2: 設計・API の整備
- 目的: MVP 実装に必要な最小のデータモデル/API/UI を決める
- 主に触るドキュメント: `02` / `03`
- 完了条件:
  - テーブル定義・RLS ・主要エンドポイントが確定
  - 画面構成（MVP）と UI チェックリストが `02` に反映
  - 関連セクションの目安:
    - `01`: 9.1 MVP 代表ユーザーフロー
    - `02`: 3.1 ドメインモデル / 3.3 テーブル定義 / 4.1〜4.3 UI
    - `03`: 2.2〜2.3（特に 2.2.1 MVP 代表フローで利用するエンドポイント）
    - `04`: 5.7 MVP 代表フロー実装方針

## フェーズ3: 実装スプリント（UI/機能）
- 目的: ユーザー価値を最短で届ける機能を縦切りで実装
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - 主要フロー（拠点一覧→スケジュール表示→お気に入り）が動作
  - `04` の品質・テスト方針にある最小チェックをクリア

### フェーズ3で行う DB セットアップ

フェーズ3を完了させるために、Supabase MCP を用いた DB セットアップが必要です。

**詳細な手順は [06 DB セットアップ & 手動オペレーション](./06-db-operations.md) を参照してください。**
- セットアップの流れ: [06 節 2（Supabase MCP 導入）](./06-db-operations.md#2-supabase-mcpcursor-連携) → [06 節 3（共通フロー）](./06-db-operations.md#3-supabase-mcp-を使う場合の共通フロー) → [06 節 4（初回セットアップ）](./06-db-operations.md#4-初回セットアップフェーズ3)

**確認すべき観点:**
- [ ] Supabase MCP のセットアップ完了（Cursor への導入・初回認証）
- [ ] Supabase プロジェクトの作成完了
- [ ] 環境変数の設定完了（`NEXT_PUBLIC_SUPABASE_URL` / `NEXT_PUBLIC_SUPABASE_ANON_KEY` / `SUPABASE_SERVICE_ROLE_KEY`）
- [ ] テーブル作成完了（`facilities` / `schedules`）
- [ ] サンプルデータの投入完了（`facilities` 最低 3 件）
- [ ] 代表フローの動作確認完了（拠点一覧表示・お気に入り追加）

### フェーズ3完了確認コマンド

上記の DB セットアップ完了後、以下のコマンドを実行して確認します:

- [ ] `mise exec -- pnpm --filter web lint`（ESLint チェック）
- [ ] `mise exec -- pnpm --filter web typecheck`（TypeScript 型チェック）
- [ ] `mise exec -- pnpm --filter web test`（単体テスト）
- [ ] `mise exec -- pnpm --filter web build`（ビルド成功）※ Supabase 環境変数が必要
  - 環境変数が未設定の場合、`Missing Supabase environment variables` エラーで失敗します（セットアップできているかの自動チェック）
- 注: E2E テスト（`pnpm --filter web e2e`）はフェーズ4で整備予定

## フェーズ4: ローカルテスト / UI調整（骨格）
- 目的: ローカル環境で本番同等レベルの**信頼性**を確保し、代表フローのUI骨格を整える（チームみらい系プロダクトのトーンを意識）
- 主に触るドキュメント: `04` / `dev-sessions`
- 完了条件:
  - Lint / 型チェック / 単体テスト / 代表フローの E2E テストがローカルで安定して通る
  - 代表フロー（拠点一覧→スケジュール表示→お気に入り）のテスト観点表（等価分割 / 境界値）が作成され、実装済みテストと対応づけられている
  - トップ / 拠点一覧 / スケジュール詳細 / お気に入りページに関して、**レイアウトと情報構造が固まったUI骨格**ができている（色・装飾は暫定でOK）
  - ライトグリーンを基調としたテーマカラーと、チームみらい系プロダクトに近いベースコンポーネントのスタイル方針が暫定決定されている（詳細なデザイン調整はフェーズ7）

このフェーズでは「見た目の細かい美しさ」よりも、**壊れにくさと基本レイアウトの安定**を優先します。デザインのトーン & マナーについては、フェーズ7の「デザインリファレンス（チームみらい系プロダクト）」も参照してください。

## フェーズ5: 施設情報データ取得・投入フロー
- 目的: 保育施設の基本情報（名称 / 住所 / 公式サイトURL など）を、継続的に取得し DB に投入できる仕組みを作る
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - ✅ ターゲットとなるWebサイト群と、取得する項目（施設名 / 住所 / URL 等）が整理されている
    - 名古屋市の2ページ（応援拠点・支援拠点）を対象とし、取得項目を [04 開発ガイド](./04-development.md) 9.5.1 節に記載
  - ✅ 利用規約・robots.txt などの観点から、許可される取得方法とNGな方法が明文化されている
    - スクレイピングガイドラインを [04 開発ガイド](./04-development.md) 9.5.1 節に記載（アクセス頻度・User-Agent・取得範囲等）
  - ✅ 1〜2サイト分について、**クロール or スクレイピングの PoC** が完了し、JSON などの中間形式で施設情報を取得できている
    - `apps/scripts/fetch-nagoya-childcare-bases.ts` を実装。`--dry-run` モードでJSON出力可能
  - ✅ 取得データを Supabase の `facilities` などのテーブル構造にマッピングし、**投入スクリプト or 手動投入フロー（CSV / SQL 等）** が定義されている
    - スクレイピングスクリプトから Supabase への直接書き込み機能を実装。手動CSVインポートフローを [04 開発ガイド](./04-development.md) 9.5.2 節に記載
  - ✅ 自動取得データと手動入力データを区別するためのスキーマ（例: `source_type` カラム）や運用ルールが `04` に記載されている
    - 運用ルール（データ衝突時の優先順位・更新頻度・ログ保存方針）を [04 開発ガイド](./04-development.md) 9.5.4 節に記載
    - 注: `source_type` カラムは将来追加予定（設計レベルで整理済み）

**実装済み内容**:
- `facilities` テーブルを全国対応スキーマに更新（[02 設計資料](./02-design.md) 3.3 節）
- Supabase MCP を使ってマイグレーションを適用し、実DBスキーマを設計通りに更新完了
- スクレイピングスクリプト（`apps/scripts/fetch-nagoya-childcare-bases.ts`）を実装・実行し、名古屋市の2ページから62件の施設データを取得・投入完了
- CSVテンプレートと手動インポート手順を [04 開発ガイド](./04-development.md) 9.5.5 節に記載
- 既存3件のサンプルデータに全国対応カラムの値をバックフィル完了

**実DB反映状況**:
- マイグレーション適用完了: 全国対応スキーマ（`facility_type`, `detail_page_url`, 住所コード系カラム等）を追加
- データ投入完了: 合計65件（既存3件＋新規62件）、`facility_type`は2種類（`childcare_ouen_base`, `childcare_support_base`）、13区のデータを登録
- Webアプリ側のビルド確認完了: 新しいスキーマに対応したデータ取得が正常に動作することを確認

**注**: 現在は名古屋市の一部施設（65件）のみを対象としています。InstagramアカウントURLのカバーは [フェーズ9: InstagramアカウントURLの全面カバー](#フェーズ9-instagramアカウントurlの全面カバー) で実施します。

ここでは Instagram にはまだ触らず、**施設の基本情報**にフォーカスします。

## フェーズ6: Instagram 連携 & お気に入りでのスケジュール埋め込み
- 目的: Instagram投稿を埋め込み表示し、お気に入りセクションで月間スケジュールを確認できる機能を実装する
- 主に触るドキュメント: `02` / `03` / `04` / `docs/instagram-integration/`（調査・設計方針の検討ドキュメント）
- 検討ドキュメント: [`docs/instagram-integration/`](./instagram-integration/README.md) - 複数のAIからの知見を集約し、最適な実装方針を決定するためのドキュメント集
- 完了条件:
  - ✅ 対象となる Instagram アカウントと、どのような形式でスケジュール情報が投稿されているか（キャプションのURL / プロフィールリンク / 固定投稿など）が整理されている
  - ✅ 公式API / 埋め込み / 画面スクレイピング等の手段について、利用規約に沿った現実的な選択肢が比較されている
  - ✅ 少なくとも 1〜2 アカウントについて、**人間が投稿内容を見てスケジュールURLを登録する最小フロー**（手動）と、そのデータを DB に保存する方法が決まっている
  - ✅ Instagram埋め込みコンポーネントが実装され、お気に入りセクションでスケジュールを表示できる
  - ✅ 上記のフローとデータ構造（例: `schedules` テーブルの更新ポリシー）が `docs/04-development.md` に Runbook としてまとまっている

**検討ドキュメント**: 調査・設計方針の検討は [`docs/instagram-integration/`](./instagram-integration/README.md) で実施。複数のAIからの知見を集約し、最適な実装方針を決定する。

**実装済み内容**:
- Instagram埋め込みコンポーネント（`InstagramEmbed.tsx`）の実装
  - Instagram公式のblockquote埋め込み方法を使用（API不要）
  - 親要素に内接するようにサイズ調整（`globals.css`にスタイル追加）
- お気に入りセクションにInstagramスケジュール表示機能を実装
  - `FavoritesSection`コンポーネントにスケジュール表示機能を追加
  - 月切り替え機能（前月・次月）を実装（初期表示は今月）
- 手動でのスケジュールURL登録フローの確立
  - `schedules` テーブルへの手動登録手順を [04 開発ガイド](./04-development.md) 9.6節に記載
- 実装メモ:
  - `app/facilities/[id]/page.tsx` の `params` は Next.js の実ランタイム仕様（Promise で渡される）に合わせて `Promise<{ id: string }>` とし、
    `pnpm dev` 実行時の警告を避けるために `await params` で展開する実装としている（phase6 のリファクタ計画で検討した同期型 `params` 案からの差分）。

**開発セッション**: [`docs/dev-sessions/20251128-session-phase6-vercel-deploy.md`](./dev-sessions/20251128-session-phase6-vercel-deploy.md) を参照

**注**: 現在は一部の施設・スケジュールURLのみを手動で登録している状態です。全施設のスケジュールURLカバーは [フェーズ10: スケジュールURLの全面カバー](#フェーズ10-スケジュールurlの全面カバー) で実施します。

フェーズ5とは独立して進めることで、**施設情報（静的に近い）とスケジュール情報（頻繁に変わる）を分離**し、それぞれに適した更新・運用設計が可能になります。

## フェーズ7: 仮MVP環境のVercelデプロイ
- 目的: 仮MVPとして動作する環境をVercelにデプロイし、実際に使える状態にする
- 主に触るドキュメント: `04` / `dev-sessions`
- 完了条件:
  - ✅ Vercelプロジェクトの作成・連携が完了している
  - ✅ 環境変数（`NEXT_PUBLIC_SUPABASE_URL`、`NEXT_PUBLIC_SUPABASE_ANON_KEY`）がVercelに設定されている
  - ✅ ビルドエラーが解消され、デプロイが成功している
  - ✅ デプロイ後の動作確認が完了している（代表フローが動作することを確認）

**実装済み内容**:
- Vercelプロジェクトの作成・GitHub連携完了
- 環境変数の設定完了（`NEXT_PUBLIC_SUPABASE_URL`、`NEXT_PUBLIC_SUPABASE_ANON_KEY`）
- ESLintエラー修正（`@ts-expect-error`ディレクティブに説明を追加）
- ビルドキャッシュの問題解決（`.next`ディレクトリの削除による再ビルド）
- デプロイ成功確認

**開発セッション**: [`docs/dev-sessions/20251128-session-phase6-vercel-deploy.md`](./dev-sessions/20251128-session-phase6-vercel-deploy.md) を参照

**注**: このフェーズは「仮MVP環境」として、一部の施設・スケジュールURLのみを手動で登録した状態でデプロイしています。本番相当のクオリティ向上は [フェーズ8: 仮MVP環境のクオリティアップ](#フェーズ8-仮mvp環境のクオリティアップ) で実施します。

## フェーズ8: 仮MVP環境のクオリティアップ
- 目的: 仮MVP環境のUI/UX・エラーハンドリング・運用まわりを磨き込み、より使いやすい状態にする
- 主に触るドキュメント: `02`（画面構成・UI） / `04`（Runbook・エラーハンドリング）
- 完了条件:
  - 代表ページ（トップ / 拠点一覧 / お気に入り）について、エラーハンドリングが適切に実装されている（Instagram埋め込み失敗時のフォールバック表示など）
  - ローディング状態・空状態の表示が適切に実装されている
  - 基本的なアクセシビリティチェック（キーボード操作、スクリーンリーダー対応など）が完了している
  - スマホ / PC の主要な表示パターンで、致命的な崩れや操作しづらさがないことを確認している
  - 運用上のトラブルシューティング手順が `04 開発ガイド` に追記されている

このフェーズでは「見た目の細かい美しさ」よりも、**エラーハンドリング・アクセシビリティ・安定性**を優先します。デザインの詳細な調整は [フェーズ11: デザイン / UX 仕上げ & リリース準備](#フェーズ11-デザイン--ux-仕上げ--リリース準備) で実施します。

## フェーズ9: InstagramアカウントURLの全面カバー
- 目的: 一部の施設のみの状態から、全施設のInstagramアカウントURLを対象としたデータ投入・更新フローを確立する（検索APIは Google Custom Search API / Programmable Search Engine を第一候補とする）
- 主に触るドキュメント: `docs/instagram-integration/` / `02` / `03` / `docs/04-development.md`（環境変数・Runbook） / `apps/web/env.local.example`
- 完了条件:
  - Google Programmable Search Engine（CSE）が `site:instagram.com` を中心に構成され、`GOOGLE_CSE_API_KEY` / `GOOGLE_CSE_CX` などの環境変数がサーバー専用として設定・ドキュメント化されている
  - Next.js サーバーサイドの検索API（例: `/api/instagram-search`）が PoC レベルで動作し、Google CSE から取得した結果を正規化して返却できる（エラーハンドリング方針を含む）
  - 複数施設向けの半自動登録フロー（候補提示→人間が採用/スキップを選ぶ）が用意され、`facilities.instagram_url` を更新するか、少なくとも採用候補をCSV/JSONに出力できる
  - Runbook（`docs/instagram-integration/`）に検索APIベースの標準フローと、フォールバックとしての手動ブラウザ検索フローが整理されている
  - データ品質チェック（Instagramドメイン以外・重複URLの検出）が1回以上実施され、dev-sessionsに記録されている
- 代表タスク例:
  - CSEの最小セットアップ（検索対象スコープ設定、API有効化、キー/CX取得、環境変数設計のドキュメント化）
  - Google CSE を叩く Next.js Route Handler / API Route のPoC設計・実装
  - 検索クエリ設計と数件の施設での手動検証（成功/失敗パターンの整理）
  - 半自動登録ツール（CLIまたは管理UI）で候補提示と採用/スキップを行うフローの設計
  - Runbook更新（標準フローとフォールバック手順、諦め条件、品質チェック手順）
  - 詳細計画: [`05-09-instagram-account-url-coverage.md`](./05-09-instagram-account-url-coverage.md)

## フェーズ10: スケジュールURLの全面カバー
- 目的: 一部のスケジュールURLのみの状態から、全施設の月間スケジュールURLを対象としたデータ投入・更新フローを確立する
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - 各施設の月間スケジュールURLが可能な限り特定され、`schedules` テーブルに登録されている
  - スケジュールURLのデータ更新フロー（月次更新の手順）がドキュメントに Runbook としてまとまっている
  - スケジュールURLのデータ品質チェック（有効性・更新漏れの確認）が実施されている
## フェーズ11: デザイン / UX 仕上げ & リリース準備
- 目的: 実データを踏まえて UI / UX を本番さながらのクオリティに高め、公開できる状態に仕上げる
- 主に触るドキュメント: `02`（画面構成・UI） / `04`（Runbook・リリースノート）
- 完了条件:
  - 代表ページ（トップ / 拠点一覧 / 詳細 / お気に入り）について、カラーリング・タイポグラフィ・余白・コンポーネントの一貫性が整えられ、**「見せられる」ではなく「使ってもらえる」レベル**のデザインになっている
  - 実際の施設データとスケジュールURLが入った状態で、代表フローの E2E テストが再確認されている（テスト観点表も更新）
  - スマホ / PC の主要な表示パターンで、致命的な崩れや操作しづらさがないことを簡易チェックリストで確認している
  - リリースノート（どのフェーズで何を実装したか、既知の制約）と、リリース〜ロールバック手順が `docs/04-development.md` に追記されている

このフェーズで「本番さながらのデザイン」を狙うため、フェーズ4では **骨格レベル**、フェーズ8では **エラーハンドリング・安定性**、フェーズ11で **ビジュアル / UX 最適化レベル** と段階を分けます。

### デザインリファレンス（チームみらい系プロダクト）
- 本プロジェクトの配色・タイポグラフィ・コンポーネント設計は、以下のプロダクトのトーン & マナーを参考にする:
  - [チームみらい公式サイト](https://team-mir.ai/)
  - [みらいまる見え政治資金](https://marumie.team-mir.ai/o/team-mirai)
  - [みらい議会](https://gikai.team-mir.ai/)
  - [アクションポータル](https://action.team-mir.ai/)
- 共通イメージ:
  - 余白を多くとったフラットなレイアウト
  - 白ベースにアクセントカラーを絞った配色（テーマカラーはライトグリーン）
  - カード型で情報をまとめた構造
  - 読みやすさとアクセシビリティを意識したフォントサイズ・コントラスト

## フェーズ12: デプロイ先の検討（コスト最適化）
- 目的: 個人開発としてのコストと運用負荷を抑えつつ、Next.js + Supabase 構成に適した本番デプロイ先を決める
- 主に触るドキュメント: `02` / `04`
- 完了条件:
  - Vercel / Cloudflare Pages / その他候補について、ざっくりとした費用感・制約・運用イメージが比較されている
    - 参考: [デプロイ先比較資料](https://gemini.google.com/share/ec2dfff5cfa2) を考慮する
  - 選定したデプロイ先と理由が `04 開発ガイド`（ホスティング / 運用セクション）に明文化されている
  - 本番相当環境を 1 つだけにするか、ステージングを分けるかの方針が決まっている

**注**: フェーズ7以降、仮MVP環境として Vercel を利用してきましたが、本番反映の直前に本番デプロイ先を再検討します。Cloudflare Pages など、よりコスト効率の良い選択肢も検討対象となります。

## フェーズ13: 本番テスト & 監視セットアップ
- 目的: 本番 URL 上で代表フローが問題なく動くことを確認し、最低限の監視・ログ収集を整える
- 主に触るドキュメント: `04` / `dev-sessions`
- 完了条件:
  - 代表フロー（拠点一覧→スケジュール表示→お気に入り）について、本番環境での E2E テスト or 手動チェック手順が実施・記録されている
  - エラーログ（例: Supabase・フロントエンドのエラーログ）が確認できる状態になっている
  - シンプルな稼働監視（例: Uptime チェック）を 1 つ以上セットアップし、確認方法が `04` に記載されている

## フェーズ14: リリース告知 & MVP完了
- 目的: MVP として公開できる状態にしたうえで、対象ユーザーへ告知し、フィードバックを受け取れる状態にする
- 主に触るドキュメント: `01` / `04`
- 完了条件:
  - `01 要件` の MVP 受け入れ基準を満たしていることが確認され、「MVP完了」の定義が満たされたと判断できる
  - リリースノート（実装した機能 / 既知の制約 / 今後の予定）が `04 開発ガイド` に追記されている
  - 告知チャネル（X / ブログ / 身近なユーザーなど）を 1〜2 個選び、初回のリリース告知を実施している
  - フィードバックを受け取る手段（フォーム / DM / 口頭メモなど）と、その扱い方針が簡単に決まっている

---

<a id="ops-rules"></a>
## 運用ルール（フェーズ × セッション）
1. 新しいタスクを始めるときは、まず属するフェーズを 1 つ選ぶ（上記から）。
2. 1 回の作業は 15〜60 分程度を目安に、`dev-sessions/template-session.md` をコピーし、以下の流れでセッションを進める:
   - **壁打ち**: AIと議論して方針を決め、「コンテキスト・合意事項」セクションに記録
   - **計画**: 「チェックリスト式実装計画書」セクションで、タスクを1プロンプト単位に分解し、各タスクの「実行プロンプト案」を設計
   - **実行**: プロンプト案をコピペしてAIに指示し、チェックリストに沿って実装
   - **検証**: 検証・テストのチェックリストを実行
   - **ふりかえり**: 完了タスクにチェックを入れ、未完了タスクを「次回に持ち越すタスク」にコピー
   **重要**: dev-sessions ファイルを作成する際は、**必ず `date` コマンドを実行して現在日付を取得し、その日付を使用する**。AIの内部的な日付認識に依存せず、システムの現在日付を確認すること。
3. 終了時に「結果/ふりかえり/持ち越し」を必ず記録する。持ち越しは次回セッションの冒頭で再利用。
4. フェーズ完了時は関連ドキュメント（01〜04）のリンクや表の更新だけでも良いので、最小反映を行う。

### フェーズ計画の正本管理
- フェーズごとの詳細計画と完了条件の**正本はこのファイル（05-00）に集約**し、`phase-planning` の出力や `docs/dev-sessions/*` は「その時点の作業用ラフ/抜粋」として扱う。
- フェーズごとの詳細な実装計画は、必要に応じて `docs/05-<フェーズ番号>-*.md` 形式の専用ファイルに切り出す（例: `docs/05-09-instagram-account-url-coverage.md`）。このファイル（05-00）は全体のインデックスとして、各フェーズの「目的 / 主に触るドキュメント / 完了条件 / 代表タスク例」のみを持つ。
- `phase-planning` で新しい決定や計画変更が生じた場合は、必ず本ファイル（または該当フェーズの詳細ファイル）の該当フェーズと「フェーズ進捗状況 / 次のステップ」を更新する。
- dev-sessions には必要な抜粋やスナップショットだけを貼り、全文を載せる場合は付録扱いとし、正本が本ファイル（または該当フェーズの詳細ファイル）である旨を明記する。

<a id="dev-sessions-date"></a>
### dev-sessions ファイルの日付の付け方（AI作業時の標準フロー）

**AIが作業する際の必須手順**:

1. **現在日付を取得する**（必ずコマンドで確認）:
   ```bash
   date +%Y%m%d  # 例: 20251130
   ```

2. **その日の既存ファイルを確認し、連番を決定する**:
   ```bash
   ls docs/dev-sessions/YYYYMMDD-*.md | sort | tail -1
   # 例: 20251130-02-phase8-followup.md が最後のファイルの場合
   # 次の連番は 03
   ```
   - 既存ファイルがない場合、連番は `01` から開始
   - 既存ファイルがある場合、最大連番+1を新しい連番とする（例: 最大が `02` なら `03`）

3. **ファイル名と本文の日付を生成する**:
   - ファイル名: `YYYYMMDD-連番-説明.md`（例: `20251130-01-phase8-quality-up.md`）
     - `連番` は2桁の数字（`01`, `02`, `03`...）
     - `説明` はセッションの内容を表す短い文字列（例: `phase8-quality-up`, `phase6-instagram`）
   - 本文の「日付: YYYY-MM-DD」: 取得した `YYYYMMDD` 形式を `YYYY-MM-DD` 形式に変換して使用
     - 変換方法（bashの文字列操作）: `${YYYYMMDD:0:4}-${YYYYMMDD:4:2}-${YYYYMMDD:6:2}`
       - 例: `20251130` → `2025-11-30`
     - または、`sed` を使う: `echo "20251130" | sed 's/\(....\)\(..\)\(..\)/\1-\2-\3/'`

4. **過去日のセッションを記録する場合**:
   - セッション実施日を明示的に指定し、`date -d` コマンドで `YYYYMMDD` 形式を取得する:
     ```bash
     date -d "2025-11-22" +%Y%m%d  # 例: 20251122
     ```
   - その日の既存ファイルを確認し、連番を決定する（上記手順2を参照）
   - ファイル名には `YYYYMMDD-連番-説明.md` 形式を使用
   - 本文には `YYYY-MM-DD` 形式に変換して使用（上記の変換方法を参照）

**禁止事項**:
- ❌ AIの内部的な「今日の日付」を推測して使用すること
- ❌ 既存ファイルの日付をコピーして使用すること（日付が古い可能性がある）
- ❌ 手入力で日付を書くこと（数字の打ち間違いのリスク）
- ❌ 連番を確認せずにファイルを作成すること（重複や順番の混乱を避けるため）

**推奨**: ファイル作成前に必ず `date` コマンドを実行し、その日の既存ファイルを確認してから連番を決定すること。

---

## フェーズ進捗状況（2025-12-11 時点）

### 進行中のフェーズ
- フェーズ9: InstagramアカウントURLの全面カバー  
  - Google Custom Search API / Programmable Search Engine を採用する方針を決定。CSEセットアップと環境変数設計を先に行い、その後 `/api/instagram-search` のサーバーサイドPoCと半自動登録ツールの設計に着手する。

### 完了したフェーズ
- ✅ フェーズ1: 準備・要件の具体化（環境 / ドキュメント / MVP スコープ確定）
- ✅ フェーズ2: 設計・API の整備
- ✅ フェーズ3: 実装スプリント（UI/機能）
- ✅ フェーズ4: ローカルテスト / UI調整（骨格）
- ✅ フェーズ5: 施設情報データ取得・投入フロー（名古屋市の一部施設、65件）
- ✅ フェーズ6: Instagram 連携 & お気に入りでのスケジュール埋め込み
- ✅ フェーズ7: 仮MVP環境のVercelデプロイ
- ✅ フェーズ8: 仮MVP環境のクオリティアップ

**フェーズ8の実装内容**:
- 代表ページ（トップ/拠点一覧/詳細/お気に入り）のエラーハンドリングを実装
  - 共通コンポーネント（`ErrorAlert`, `LoadingSpinner`, `EmptyState`, `StatusMessage`）を追加
  - トップページ: Supabase取得失敗時のエラー表示と空状態表示を追加
  - 詳細ページ: `error.tsx` / `not-found.tsx` を実装
  - お気に入りセクション: スケジュール取得失敗時のエラー表示を追加（`FavoriteFacilityCard` に `isLoading` / `error` プロパティを追加）
- Instagram埋め込みのフォールバック表示を改善（埋め込み失敗時に投稿URLへの直接リンクを表示）
- アクセシビリティ改善: エラー/ローディングメッセージに `aria-live` / `role` を付与、ボタンのフォーカスインジケータを改善
- レスポンシブレイアウトの改善: モバイル表示の調整、テーブルの横スクロール対応
- 運用Runbookの更新: `docs/04-development.md` に仮MVP環境でのトラブルシューティング手順を追記
- PRレビュー指摘事項の修正:
  - Instagram埋め込みの5秒タイマーをrefで管理し、アンマウント時のクリーンアップを追加（React警告の解消）
  - 月切り替え時のローディング状態管理を改善（staleリクエストが最新リクエストのローディング表示を打ち消さないように修正）

**開発セッション**:
- [`docs/dev-sessions/20251130-session-phase8-quality-up.md`](./dev-sessions/20251130-session-phase8-quality-up.md) - フェーズ8の主要実装
- [`docs/dev-sessions/20251130-session-phase8-followup.md`](./dev-sessions/20251130-session-phase8-followup.md) - ローディング/エラーUI実装とテスト追加
- [`docs/dev-sessions/20251202-01-phase8-pr-review-fix.md`](./dev-sessions/20251202-01-phase8-pr-review-fix.md) - PRレビュー指摘事項の修正

### 次のステップ
- **フェーズ9**: CSEセットアップ（検索対象スコープ＋API有効化＋キー/CX取得＋環境変数追加）→ `/api/instagram-search` PoC → 半自動登録フロー設計・Runbook更新 → データ品質チェックの順で進める。
- **フェーズ10**: スケジュールURLの全面カバー（月次更新フローと品質チェックの整備）
- **フェーズ11**: デザイン / UX 仕上げ & リリース準備（本番クオリティへの磨き込み）


