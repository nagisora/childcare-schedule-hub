# フェーズ詳細ファイル作成ガイド

## 概要

フェーズ9以降のフェーズについて、詳細な実装計画を `docs/05-<フェーズ番号>-*.md` 形式の専用ファイルに切り出す際の作成ガイドです。

- テンプレート: `docs/phase-planning/template-phase-detail.md` を使用
- 参照例: `docs/05-09-instagram-account-url-coverage.md`（フェーズ9の実装例）
- 正本管理: `docs/05-00-development-phases.md` の該当フェーズセクションに「詳細計画: `<リンク>`」を追加

## このガイドの位置づけ（正本の考え方）

- `docs/05-00-development-phases.md` は **全体の索引（高レベル）** として、各フェーズの「目的 / 主に触るドキュメント / 完了条件 / 代表タスク例」と、進捗状況・次のステップを持つ
- `docs/05-<フェーズ番号>-*.md` は **そのフェーズの詳細計画 & 進捗管理の正本**（完了条件やタスクの進捗チェックはここに集約してよい）
- `docs/dev-sessions/` は **その日の計画と実行ログ**（詳細計画の全文を正本として運用しない）

## 前提

- フェーズの全体像は `docs/05-00-development-phases.md` に記載されている
- dev-sessions の運用ルールは `docs/dev-sessions/README.md` に記載されている
- すでに進行中のフェーズや「次にやる候補フェーズ」は `05-00-development-phases.md` の末尾（フェーズ進捗状況 / 次のステップ）に記載されている
- チェックリスト記法などの運用ルールは `docs/05-00-development-phases.md` の「運用ルール（フェーズ × セッション）」に従う（例: `- [ ]` / `- [x]`、絵文字で進捗を表さない）

## 作成手順

### 1. 対象フェーズの特定

- ユーザーのプロンプト内に「フェーズ10」「フェーズ11」などの指定があれば、それを最優先で対象フェーズとみなす
- 明示指定がない場合は、`docs/05-00-development-phases.md` の「フェーズ進捗状況」「次のステップ」を確認し、**候補フェーズを1〜2個提案したうえで、どれを進めるかユーザーに確認**する

### 2. 関連ドキュメントの洗い出し

対象フェーズの説明に記載されている「主に触るドキュメント」や関連セクションを洗い出し、必要に応じて以下を参照しながら前提を整理する：

- `docs/01-requirements.md`
- `docs/02-design.md`
- `docs/03-api.md`
- `docs/04-development.md`
- `docs/instagram-integration/` 配下（フェーズ6/9/10などInstagram関連の場合）

### 3. テンプレートのコピーとファイル作成

1. `docs/phase-planning/template-phase-detail.md` をコピーして新規ファイルを作成
   - ファイル名例: `docs/05-10-schedule-url-coverage.md`
   - ファイル名形式: `docs/05-<フェーズ番号>-<簡潔な説明>.md`
2. ファイル名に合わせてタイトルを更新（例: `# フェーズ10詳細: スケジュールURLの全面カバー`）

#### 命名の注意（推奨）

- `<簡潔な説明>` は英小文字の kebab-case を推奨（例: `schedule-url-coverage`, `design-ux-polish`）
- ファイル名は将来の grep/リンク維持のため、表記ゆれ（全角/空白/記号多用）を避ける

### 4. 各セクションの埋め方

#### 1. 概要

- **対応フェーズ**: `フェーズ<番号>` を明記（例: `フェーズ10`）
- **目的**: `docs/05-00-development-phases.md` の該当フェーズの「目的」を起点に、必要に応じて補足して記載
- **スコープ**: このフェーズで対象とする範囲を明記
- **非スコープ**: このフェーズでは扱わないこと（将来のフェーズや別タスクに回すもの）を明記
- **完了条件**: `docs/05-00-development-phases.md` の該当フェーズの完了条件を参照しつつ、必要なら「観測可能な表現（何ができればOKか）」に具体化して、チェックリストで管理
- **関連ドキュメント**: 関連するドキュメントへのリンクを列挙

#### 2. 前提・制約

- **規約・利用条件**: 外部APIやサービスの利用規約、スクレイピングガイドラインなど
- **コスト・レート制限**: API呼び出しの料金、1日あたりの上限、レート制限など
- **データ品質要件**: データの正確性、重複チェック、バリデーション要件など
- **技術的制約**: 既存システムとの互換性、パフォーマンス要件など

#### 3. 実装計画

対象フェーズを 3〜7 個程度のタスクに分解し、各タスクについて以下を記載：

- **タスク名**: 何をするか
- **完了条件**: いつ終わったと言えるか（チェックリスト形式で複数記載）
- **検証方法**: どのコマンド/どの画面で確認するか
- **dev-sessions粒度**: 想定セッション数・所要時間
- **更新先ドキュメント**: このタスクで更新するドキュメントのパス

**参考**: フェーズ9の例（`docs/05-09-instagram-account-url-coverage.md`）では、各タスクにアンカーリンク（`<a id="task-1"></a>`）を付けて、進捗チェックリストからリンクできるようにしている

**フェーズ完了時のチェックリスト**: 実装計画の最後に「フェーズ完了時のチェックリスト」セクションを追加し、以下の項目を含める：
- フェーズの完了チェック（完了条件の確認）
- コードのリファクタリング（`/remove-ai-code-slop`、`/refactor-plan`）
- プルリクエストの作成
- Cursor Agent Review（リミットに余裕がある場合のみ）
- Vercelのエラー確認
- mainブランチへのマージ（`/pr-merge-cleanup`）

#### 4. 品質チェック

- **データ品質チェック**: チェック項目をチェックリスト形式で列挙
- **検証方法**: 検証手順を記載（SQLクエリ、スクリプト実行、手動確認など）
- **検証クエリ例（データベースを使用する場合）**: SQLクエリやコマンドの例を記載（必要に応じて）
- **チェック実施タイミング**: いつチェックを実施するか

#### 5. リスク・撤退条件・ロールバック

- **リスク**: 想定されるリスクを列挙
- **撤退条件**: 諦める条件を明記
- **ロールバック手順**: 問題が発生した場合に元に戻す手順
- **フォールバック手順**: 標準フローが使えない場合の代替手段

#### 6. 将来の拡張・メモ

- **拡張候補**: 将来検討する可能性のある機能・改善点
- **運用上の注意**: 運用時に気をつけるべき点、定期的なメンテナンス項目など
- **関連する将来フェーズ**: このフェーズの結果を活用する将来のフェーズへの言及

### 5. 進捗チェックリストの追加（推奨）

フェーズ9の例（`docs/05-09-instagram-account-url-coverage.md`）では、ファイル冒頭に「0. 進捗チェックリスト（正本）」セクションを追加している：

- フェーズ全体の完了条件をチェックリスト形式で記載
- 実装タスク（セッション粒度の進捗）をチェックリスト形式で記載
- 各タスクにはアンカーリンクを付けて、詳細セクションからリンクできるようにする

この形式を採用する場合は、テンプレートの「1. 概要」の前に「0. 進捗チェックリスト（正本）」セクションを追加する。

#### 進捗チェックリストの最小スニペット（コピペ用）

- 例:
  - `## 0. 進捗チェックリスト（正本）`
  - `### フェーズ<番号>: 全体の完了条件`（`05-00` の完了条件をここにコピーしてチェック管理する）
  - `### 実装タスク（セッション粒度の進捗）`（`タスク1〜` を並べる）
- 完了にしたら、可能なら同じ行末に `YYYY-MM-DD` と証跡（dev-sessions/PR/Runbookの該当箇所リンク等）を併記する

### 6. `05-00-development-phases.md` への反映

1. `docs/05-00-development-phases.md` の該当フェーズセクションに「詳細計画: `docs/05-<フェーズ番号>-*.md`」へのリンクを追加
2. `05-00` は索引なので、詳細タスクの全文を移植しない（必要最小限の代表タスク例 + 詳細へのリンクに留める）
3. フェーズ進捗状況セクションを更新（必要に応じて）

## 参考例

- **テンプレート**: `docs/phase-planning/template-phase-detail.md`
- **実装例**: `docs/05-09-instagram-account-url-coverage.md`（フェーズ9の実装例）
  - 進捗チェックリストの追加方法
  - タスクへのアンカーリンクの付け方
  - 各セクションの具体的な記載例

## 注意事項

- 詳細ファイルは「その時点の作業用ラフ」ではなく、**進捗管理の正本**として扱う
- dev-sessions には必要な抜粋やスナップショットだけを貼り、全文を載せる場合は付録扱いとし、正本が詳細ファイルである旨を明記する
- フェーズ計画の変更や決定事項は、詳細ファイルと `05-00-development-phases.md` の両方を更新する
