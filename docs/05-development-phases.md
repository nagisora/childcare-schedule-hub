# 05 開発フェーズ（少ない時間で前進するための道しるべ）

本書は、短時間の作業でも迷わず進められるように、開発フェーズを高レベルで定義する。各フェーズの詳細作業は `docs/dev-sessions/` のテンプレートを用いてセッション単位に分割・記録する。

関連: `docs/04-development.md`（日々の開発/運用ガイド）、`docs/dev-sessions/template-session.md`（作業テンプレ）

## フェーズ一覧
- フェーズ0: 準備（環境 / ドキュメント）
- フェーズ1: 要件の具体化（MVP スコープ確定）
- フェーズ2: 設計・API の整備
- フェーズ3: 実装スプリント（UI/機能）
- フェーズ4: ローカルテスト / UI調整（骨格）
- フェーズ5: 施設情報データ取得・投入フロー
- フェーズ6: Instagram 連携によるスケジュールURL取得フロー
- フェーズ7: デザイン / UX 仕上げ & リリース準備

---

## フェーズ0: 準備（環境 / ドキュメント）
- 目的: ローカル開発が即開始でき、主要ドキュメントが参照可能な状態を作る
- 主に触るドキュメント: `00` / `04`
- 完了条件:
  - `pnpm dev --filter apps/web` でローカル起動できる
  - `00/04` に沿って初見でも開発を始められるリンク導線がある

## フェーズ1: 要件の具体化（MVP スコープ確定）
- 目的: MVP の機能・非機能・受け入れ基準を合意し、優先順位を固定
- 主に触るドキュメント: `01`
- 完了条件:
  - MVP のユーザーストーリー / 受け入れ基準が明文化
  - 影響する `02/03/04` の更新ポイントが洗い出されている

## フェーズ2: 設計・API の整備
- 目的: MVP 実装に必要な最小のデータモデル/API/UI を決める
- 主に触るドキュメント: `02` / `03`
- 完了条件:
  - テーブル定義・RLS ・主要エンドポイントが確定
  - 画面構成（MVP）と UI チェックリストが `02` に反映
  - 関連セクションの目安:
    - `01`: 9.1 MVP 代表ユーザーフロー
    - `02`: 3.1 ドメインモデル / 3.3 テーブル定義 / 4.1〜4.3 UI
    - `03`: 2.2〜2.3（特に 2.2.1 MVP 代表フローで利用するエンドポイント）
    - `04`: 5.7 MVP 代表フロー実装方針

## フェーズ3: 実装スプリント（UI/機能）
- 目的: ユーザー価値を最短で届ける機能を縦切りで実装
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - 主要フロー（拠点一覧→スケジュール表示→お気に入り）が動作
  - `04` の品質・テスト方針にある最小チェックをクリア

### フェーズ3で行う DB セットアップ

フェーズ3を完了させるために、Supabase MCP を用いた DB セットアップが必要です。

**詳細な手順は [06 DB セットアップ & 手動オペレーション](./06-db-operations.md) を参照してください。**
- セットアップの流れ: [06 節 2（Supabase MCP 導入）](./06-db-operations.md#2-supabase-mcpcursor-連携) → [06 節 3（共通フロー）](./06-db-operations.md#3-supabase-mcp-を使う場合の共通フロー) → [06 節 4（初回セットアップ）](./06-db-operations.md#4-初回セットアップフェーズ3)

**確認すべき観点:**
- [ ] Supabase MCP のセットアップ完了（Cursor への導入・初回認証）
- [ ] Supabase プロジェクトの作成完了
- [ ] 環境変数の設定完了（`NEXT_PUBLIC_SUPABASE_URL` / `NEXT_PUBLIC_SUPABASE_ANON_KEY` / `SUPABASE_SERVICE_ROLE_KEY`）
- [ ] テーブル作成完了（`facilities` / `schedules`）
- [ ] サンプルデータの投入完了（`facilities` 最低 3 件）
- [ ] 代表フローの動作確認完了（拠点一覧表示・お気に入り追加）

### フェーズ3完了確認コマンド

上記の DB セットアップ完了後、以下のコマンドを実行して確認します:

- [ ] `mise exec -- pnpm --filter web lint`（ESLint チェック）
- [ ] `mise exec -- pnpm --filter web typecheck`（TypeScript 型チェック）
- [ ] `mise exec -- pnpm --filter web test`（単体テスト）
- [ ] `mise exec -- pnpm --filter web build`（ビルド成功）※ Supabase 環境変数が必要
  - 環境変数が未設定の場合、`Missing Supabase environment variables` エラーで失敗します（セットアップできているかの自動チェック）
- 注: E2E テスト（`pnpm --filter web e2e`）はフェーズ4で整備予定

## フェーズ4: ローカルテスト / UI調整（骨格）
- 目的: ローカル環境で本番同等レベルの**信頼性**を確保し、代表フローのUI骨格を整える
- 主に触るドキュメント: `04` / `dev-sessions`
- 完了条件:
  - Lint / 型チェック / 単体テスト / 代表フローの E2E テストがローカルで安定して通る
  - 代表フロー（拠点一覧→スケジュール表示→お気に入り）のテスト観点表（等価分割 / 境界値）が作成され、実装済みテストと対応づけられている
  - トップ / 拠点一覧 / スケジュール詳細 / お気に入りページに関して、**レイアウトと情報構造が固まったUI骨格**ができている（色・装飾は暫定でOK）

このフェーズでは「見た目の細かい美しさ」よりも、**壊れにくさと基本レイアウトの安定**を優先します。

## フェーズ5: 施設情報データ取得・投入フロー
- 目的: 保育施設の基本情報（名称 / 住所 / 公式サイトURL など）を、継続的に取得し DB に投入できる仕組みを作る
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - ターゲットとなるWebサイト群と、取得する項目（施設名 / 住所 / URL 等）が整理されている
  - 利用規約・robots.txt などの観点から、許可される取得方法とNGな方法が明文化されている
  - 1〜2サイト分について、**クロール or スクレイピングの PoC** が完了し、JSON などの中間形式で施設情報を取得できている
  - 取得データを Supabase の `facilities` などのテーブル構造にマッピングし、**投入スクリプト or 手動投入フロー（CSV / SQL 等）** が定義されている
  - 自動取得データと手動入力データを区別するためのスキーマ（例: `source_type` カラム）や運用ルールが `04` に記載されている

ここでは Instagram にはまだ触らず、**施設の基本情報**にフォーカスします。

## フェーズ6: Instagram 連携によるスケジュールURL取得フロー
- 目的: 各施設の Instagram 投稿などから、月間スケジュールのURL（または関連情報）を取得・更新するためのフローを設計する
- 主に触るドキュメント: `02` / `03` / `04`
- 完了条件:
  - 対象となる Instagram アカウントと、どのような形式でスケジュール情報が投稿されているか（キャプションのURL / プロフィールリンク / 固定投稿など）が整理されている
  - 公式API / 埋め込み / 画面スクレイピング等の手段について、利用規約に沿った現実的な選択肢が比較されている
  - 少なくとも 1〜2 アカウントについて、**人間が投稿内容を見てスケジュールURLを登録する最小フロー**（手動）と、そのデータを DB に保存する方法が決まっている
  - 可能であれば、自動化 or 半自動化（例: キャプションからURLを抽出するスクリプト）の PoC が1本動いている
  - 上記のフローとデータ構造（例: `schedules` テーブルの更新ポリシー）が `docs/04-development.md` に Runbook としてまとまっている

フェーズ5とは独立して進めることで、**施設情報（静的に近い）とスケジュール情報（頻繁に変わる）を分離**し、それぞれに適した更新・運用設計が可能になります。

## フェーズ7: デザイン / UX 仕上げ & リリース準備
- 目的: 実データを踏まえて UI / UX を本番さながらのクオリティに高め、公開できる状態に仕上げる
- 主に触るドキュメント: `02`（画面構成・UI） / `04`（Runbook・リリースノート）
- 完了条件:
  - 代表ページ（トップ / 拠点一覧 / 詳細 / お気に入り）について、カラーリング・タイポグラフィ・余白・コンポーネントの一貫性が整えられ、**「見せられる」ではなく「使ってもらえる」レベル**のデザインになっている
  - 実際の施設データとスケジュールURLが入った状態で、代表フローの E2E テストが再確認されている（テスト観点表も更新）
  - スマホ / PC の主要な表示パターンで、致命的な崩れや操作しづらさがないことを簡易チェックリストで確認している
  - リリースノート（どのフェーズで何を実装したか、既知の制約）と、リリース〜ロールバック手順が `docs/04-development.md` に追記されている

このフェーズで「本番さながらのデザイン」を狙うため、フェーズ4では **骨格レベル**、フェーズ7で **ビジュアル / UX 最適化レベル** と段階を分けます。

---

## 運用ルール（フェーズ × セッション）
1. 新しいタスクを始めるときは、まず属するフェーズを 1 つ選ぶ（上記から）。
2. 1 回の作業は 15〜60 分程度を目安に、`dev-sessions/template-session.md` をコピーし、今日のゴールを 1〜3 個に絞る。
3. 終了時に「結果/ふりかえり/持ち越し」を必ず記録する。持ち越しは次回セッションの冒頭で再利用。
4. フェーズ完了時は関連ドキュメント（01〜04）のリンクや表の更新だけでも良いので、最小反映を行う。


