# phase-planning（フェーズ別の作業計画づくり）

## 概要

`docs/05-00-development-phases.md` を起点に、**「今回対応するフェーズ」についてAIと一緒に壁打ちし、作業計画（チェックリスト式実装計画書の元ネタ）を作る**ためのカスタムコマンドです。

- 対象フェーズの完了条件・影響範囲・関係ドキュメントを洗い出す
- そのフェーズを 3〜7 個程度のタスクに分解する
- 各タスクについて「完了条件」「検証方法」「dev-sessions に落とし込むときの単位」を整理する

このコマンドの結果は、後続の `session-recording` や dev-sessions テンプレート（`docs/dev-sessions/template-session.md`）に貼り付けて使うことを想定しています。

## 前提

- フェーズの全体像は `docs/05-00-development-phases.md` に記載されている
- dev-sessions の運用ルールは `docs/dev-sessions/README.md` に記載されている
- すでに進行中のフェーズや「次にやる候補フェーズ」は `05-00-development-phases.md` の末尾（フェーズ進捗状況 / 次のステップ）に記載されている
- フェーズ計画の正本は `docs/05-00-development-phases.md`。`phase-planning` の出力は作業用のラフであり、決定事項や計画変更は最終的に 05-00 に反映すること

## 実行してほしいこと

1. **対象フェーズの特定**  
   - ユーザーのプロンプト内に「フェーズ9」「フェーズ10」などの指定があれば、それを最優先で対象フェーズとみなす。  
   - 明示指定がない場合は、`docs/05-00-development-phases.md` の「フェーズ進捗状況」「次のステップ」を確認し、**候補フェーズを1〜2個提案したうえで、どれを進めるかユーザーに確認**する。

2. **関連ドキュメントの洗い出し**  
   対象フェーズの説明に記載されている「主に触るドキュメント」や関連セクションを洗い出し、必要に応じて以下を参照しながら前提を整理する：
   - `docs/01-requirements.md`
   - `docs/02-design.md`
   - `docs/03-api.md`
   - `docs/04-development.md`
   - `docs/instagram-integration/` 配下（フェーズ6/9/10などInstagram関連の場合）

3. **フェーズレベルのチェックリスト式実装計画書（ラフ）を作る**  
   対象フェーズを 3〜7 個程度のタスクに分解し、以下の観点で Markdown のチェックリストとしてまとめる（正本は `docs/05-00-development-phases.md` に反映する前提で、ここはラフ案とする）：
   - タスク名（何をするか）
   - 完了条件（いつ終わったと言えるか）
   - 検証方法（どのコマンド/どの画面で確認するか）
   - dev-sessions 1回分に落とす場合の粒度（1〜3タスク/セッションになるような分割案）

   例（イメージ）：
   ```markdown
   ## フェーズ9: InstagramアカウントURLの全面カバー – 実装計画ラフ

   - [ ] タスク1: 現状のinstagram_urlカバレッジを棚卸しする
         - 完了条件: 対象施設のうち、何件にinstagram_urlが入っているか集計できている
         - 検証方法: Supabaseクエリ or APIレスポンスで件数を確認
         - dev-sessions粒度: 1セッションで棚卸しと集計まで終わる規模に絞る
   - [ ] タスク2: 検索フロー（手動/自動）の方針を確定する
         - 完了条件: Runbookに手動フローと自動候補が整理され、優先順位が決まっている
         - 検証方法: `docs/instagram-integration/05-instagram-account-search.md` に追記されている
   ```

4. **dev-sessions に落とし込む候補を提案**  
   - 上で作成したフェーズレベルのチェックリストから、**「次の1セッション（15〜60分）でやると良いタスク候補」を1〜3個ピックアップ**する。  
   - 各タスクについて、`template-session.md` の「作業タスク & プロンプト設計」セクションにそのまま貼れる形で、以下を提案する：
     - タスク名
     - 完了条件
     - 実行プロンプト案（参照ファイル / やりたいこと / 制約）

5. **出力フォーマット**  
   - フェーズレベルのラフ計画（チェックリスト）と、dev-sessions用の「次セッション候補タスク」の2段構成で出力する。  
- dev-sessions 側にはフェーズ計画の全文ではなく、必要に応じて要約＋`docs/05-00-development-phases.md` へのリンク、または一部抜粋を貼る運用を推奨する。  
  - ユーザーがそのまま `docs/dev-sessions/YYYY/MM/YYYYMMDD-*.md` にコピペできるよう、Markdownのみで出力する。

## メモ

- このコマンドは「フェーズをどう攻めるか」をAIと一緒に決めるためのものであり、**実際のセッション記録は `session-recording` コマンド + dev-sessions テンプレートで行う**。
- フェーズ間の優先順位や、途中での方針転換があれば、`docs/05-00-development-phases.md` の「フェーズ進捗状況」「次のステップ」を適宜更新する提案も含めてよい。